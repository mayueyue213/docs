<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Webpack</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" type="image/png" sizes="32x32" href="/docs/images/mayueyue-32.png">
    <meta name="description" content="å‰ç«¯æ¡†æ¶å­¦ä¹ ç¬”è®°">
    <meta name="keywords" content="å‰ç«¯æ¡†æ¶å­¦ä¹ ç¬”è®°">
    
    <link rel="preload" href="/docs/assets/css/0.styles.db1112bd.css" as="style"><link rel="preload" href="/docs/assets/js/app.ee212f52.js" as="script"><link rel="preload" href="/docs/assets/js/3.2c08a1e7.js" as="script"><link rel="preload" href="/docs/assets/js/51.1b73d6a7.js" as="script"><link rel="preload" href="/docs/assets/js/9.4626406b.js" as="script"><link rel="preload" href="/docs/assets/js/14.b16e20b9.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.8d48b436.js"><link rel="prefetch" href="/docs/assets/js/100.1602b0da.js"><link rel="prefetch" href="/docs/assets/js/101.f3c5c2a8.js"><link rel="prefetch" href="/docs/assets/js/102.f43939c6.js"><link rel="prefetch" href="/docs/assets/js/103.159b3936.js"><link rel="prefetch" href="/docs/assets/js/104.dbe24320.js"><link rel="prefetch" href="/docs/assets/js/105.c13810d4.js"><link rel="prefetch" href="/docs/assets/js/106.80299f2a.js"><link rel="prefetch" href="/docs/assets/js/107.d6a48820.js"><link rel="prefetch" href="/docs/assets/js/108.dab04d1c.js"><link rel="prefetch" href="/docs/assets/js/109.af20f644.js"><link rel="prefetch" href="/docs/assets/js/11.8bd9782b.js"><link rel="prefetch" href="/docs/assets/js/110.91188884.js"><link rel="prefetch" href="/docs/assets/js/111.53da77dc.js"><link rel="prefetch" href="/docs/assets/js/112.eda7bc2a.js"><link rel="prefetch" href="/docs/assets/js/113.4414a8a9.js"><link rel="prefetch" href="/docs/assets/js/114.fdaf3805.js"><link rel="prefetch" href="/docs/assets/js/115.61d96bb4.js"><link rel="prefetch" href="/docs/assets/js/116.d0c75ead.js"><link rel="prefetch" href="/docs/assets/js/117.9fb2e5d8.js"><link rel="prefetch" href="/docs/assets/js/118.dab165c2.js"><link rel="prefetch" href="/docs/assets/js/119.02b645f0.js"><link rel="prefetch" href="/docs/assets/js/12.19d7956d.js"><link rel="prefetch" href="/docs/assets/js/120.f5e0b945.js"><link rel="prefetch" href="/docs/assets/js/121.5210288d.js"><link rel="prefetch" href="/docs/assets/js/122.4b75afbe.js"><link rel="prefetch" href="/docs/assets/js/123.b30b55a0.js"><link rel="prefetch" href="/docs/assets/js/124.bce508b6.js"><link rel="prefetch" href="/docs/assets/js/125.317ced0f.js"><link rel="prefetch" href="/docs/assets/js/126.9059ef57.js"><link rel="prefetch" href="/docs/assets/js/127.150e581a.js"><link rel="prefetch" href="/docs/assets/js/128.59763692.js"><link rel="prefetch" href="/docs/assets/js/129.4f1b1448.js"><link rel="prefetch" href="/docs/assets/js/13.8117402d.js"><link rel="prefetch" href="/docs/assets/js/130.0adfca6b.js"><link rel="prefetch" href="/docs/assets/js/131.6254a3c8.js"><link rel="prefetch" href="/docs/assets/js/132.a4396b47.js"><link rel="prefetch" href="/docs/assets/js/133.a1c6f255.js"><link rel="prefetch" href="/docs/assets/js/134.eee5ebe0.js"><link rel="prefetch" href="/docs/assets/js/135.bc10a4a7.js"><link rel="prefetch" href="/docs/assets/js/136.524c2483.js"><link rel="prefetch" href="/docs/assets/js/137.2ea86ae1.js"><link rel="prefetch" href="/docs/assets/js/138.d9fb7c73.js"><link rel="prefetch" href="/docs/assets/js/139.435ca5eb.js"><link rel="prefetch" href="/docs/assets/js/140.e5b09a69.js"><link rel="prefetch" href="/docs/assets/js/141.058be7a7.js"><link rel="prefetch" href="/docs/assets/js/142.b35fa891.js"><link rel="prefetch" href="/docs/assets/js/143.8e08aa2a.js"><link rel="prefetch" href="/docs/assets/js/144.0e2de477.js"><link rel="prefetch" href="/docs/assets/js/145.04dca499.js"><link rel="prefetch" href="/docs/assets/js/146.0cd89fc2.js"><link rel="prefetch" href="/docs/assets/js/147.8779cd5a.js"><link rel="prefetch" href="/docs/assets/js/148.02797559.js"><link rel="prefetch" href="/docs/assets/js/149.960d5bbc.js"><link rel="prefetch" href="/docs/assets/js/15.6cfb993c.js"><link rel="prefetch" href="/docs/assets/js/150.9bce4450.js"><link rel="prefetch" href="/docs/assets/js/16.216bbea9.js"><link rel="prefetch" href="/docs/assets/js/17.d1747467.js"><link rel="prefetch" href="/docs/assets/js/18.9fb89893.js"><link rel="prefetch" href="/docs/assets/js/19.e1463f50.js"><link rel="prefetch" href="/docs/assets/js/20.8fb6e451.js"><link rel="prefetch" href="/docs/assets/js/21.011555e9.js"><link rel="prefetch" href="/docs/assets/js/22.65499417.js"><link rel="prefetch" href="/docs/assets/js/23.60844ae4.js"><link rel="prefetch" href="/docs/assets/js/24.93f3daca.js"><link rel="prefetch" href="/docs/assets/js/25.ce7c13d8.js"><link rel="prefetch" href="/docs/assets/js/26.5b005337.js"><link rel="prefetch" href="/docs/assets/js/27.fda08a27.js"><link rel="prefetch" href="/docs/assets/js/28.e9c67238.js"><link rel="prefetch" href="/docs/assets/js/29.25ba646f.js"><link rel="prefetch" href="/docs/assets/js/30.f9206a2f.js"><link rel="prefetch" href="/docs/assets/js/31.0faad3b3.js"><link rel="prefetch" href="/docs/assets/js/32.f5b52577.js"><link rel="prefetch" href="/docs/assets/js/33.6b69667f.js"><link rel="prefetch" href="/docs/assets/js/34.0ee9d740.js"><link rel="prefetch" href="/docs/assets/js/35.0c4a2df2.js"><link rel="prefetch" href="/docs/assets/js/36.540b4370.js"><link rel="prefetch" href="/docs/assets/js/37.61d57a8f.js"><link rel="prefetch" href="/docs/assets/js/38.e2f625e1.js"><link rel="prefetch" href="/docs/assets/js/39.621b4bdf.js"><link rel="prefetch" href="/docs/assets/js/4.08956514.js"><link rel="prefetch" href="/docs/assets/js/40.e66f09a3.js"><link rel="prefetch" href="/docs/assets/js/41.ce9c7083.js"><link rel="prefetch" href="/docs/assets/js/42.6e6b74cd.js"><link rel="prefetch" href="/docs/assets/js/43.bbd5e59a.js"><link rel="prefetch" href="/docs/assets/js/44.ba0f46f5.js"><link rel="prefetch" href="/docs/assets/js/45.2fef609e.js"><link rel="prefetch" href="/docs/assets/js/46.ea9f7c9b.js"><link rel="prefetch" href="/docs/assets/js/47.2ab3c263.js"><link rel="prefetch" href="/docs/assets/js/48.f78d715d.js"><link rel="prefetch" href="/docs/assets/js/49.3b9094fd.js"><link rel="prefetch" href="/docs/assets/js/5.01b6ed83.js"><link rel="prefetch" href="/docs/assets/js/50.d6b43190.js"><link rel="prefetch" href="/docs/assets/js/52.768a8a03.js"><link rel="prefetch" href="/docs/assets/js/53.0bf0e3ec.js"><link rel="prefetch" href="/docs/assets/js/54.709be527.js"><link rel="prefetch" href="/docs/assets/js/55.85a552f5.js"><link rel="prefetch" href="/docs/assets/js/56.9d9e990d.js"><link rel="prefetch" href="/docs/assets/js/57.fe4e4c38.js"><link rel="prefetch" href="/docs/assets/js/58.497963ed.js"><link rel="prefetch" href="/docs/assets/js/59.cec9dc11.js"><link rel="prefetch" href="/docs/assets/js/6.4f022779.js"><link rel="prefetch" href="/docs/assets/js/60.a077d3df.js"><link rel="prefetch" href="/docs/assets/js/61.b5347b5a.js"><link rel="prefetch" href="/docs/assets/js/62.9150d3fc.js"><link rel="prefetch" href="/docs/assets/js/63.89e25b8c.js"><link rel="prefetch" href="/docs/assets/js/64.cf4926c0.js"><link rel="prefetch" href="/docs/assets/js/65.3cf8ee5d.js"><link rel="prefetch" href="/docs/assets/js/66.53068e83.js"><link rel="prefetch" href="/docs/assets/js/67.f422e20f.js"><link rel="prefetch" href="/docs/assets/js/68.4029c892.js"><link rel="prefetch" href="/docs/assets/js/69.778f4a1a.js"><link rel="prefetch" href="/docs/assets/js/7.7e83f2ae.js"><link rel="prefetch" href="/docs/assets/js/70.d81a7e95.js"><link rel="prefetch" href="/docs/assets/js/71.302e1240.js"><link rel="prefetch" href="/docs/assets/js/72.9472a7ed.js"><link rel="prefetch" href="/docs/assets/js/73.ca34ee27.js"><link rel="prefetch" href="/docs/assets/js/74.c61a46ae.js"><link rel="prefetch" href="/docs/assets/js/75.3d7fe5e3.js"><link rel="prefetch" href="/docs/assets/js/76.2f6362de.js"><link rel="prefetch" href="/docs/assets/js/77.c13acc32.js"><link rel="prefetch" href="/docs/assets/js/78.4a9407f7.js"><link rel="prefetch" href="/docs/assets/js/79.91511fe5.js"><link rel="prefetch" href="/docs/assets/js/8.634ce17e.js"><link rel="prefetch" href="/docs/assets/js/80.533968f5.js"><link rel="prefetch" href="/docs/assets/js/81.f00264c7.js"><link rel="prefetch" href="/docs/assets/js/82.3c19ef42.js"><link rel="prefetch" href="/docs/assets/js/83.bae24a9b.js"><link rel="prefetch" href="/docs/assets/js/84.2f41be2d.js"><link rel="prefetch" href="/docs/assets/js/85.9ff3c527.js"><link rel="prefetch" href="/docs/assets/js/86.123eb6f0.js"><link rel="prefetch" href="/docs/assets/js/87.dcb8e1d6.js"><link rel="prefetch" href="/docs/assets/js/88.2886e9d1.js"><link rel="prefetch" href="/docs/assets/js/89.736df243.js"><link rel="prefetch" href="/docs/assets/js/90.947afe3e.js"><link rel="prefetch" href="/docs/assets/js/91.5289166a.js"><link rel="prefetch" href="/docs/assets/js/92.7e0a6901.js"><link rel="prefetch" href="/docs/assets/js/93.67401c24.js"><link rel="prefetch" href="/docs/assets/js/94.42411128.js"><link rel="prefetch" href="/docs/assets/js/95.6b014219.js"><link rel="prefetch" href="/docs/assets/js/96.e93033c5.js"><link rel="prefetch" href="/docs/assets/js/97.1cb10f65.js"><link rel="prefetch" href="/docs/assets/js/98.f3490b34.js"><link rel="prefetch" href="/docs/assets/js/99.776d79e5.js"><link rel="prefetch" href="/docs/assets/js/vendors~photo-swipe.c7363f24.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.db1112bd.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><img src="/docs/images/mayueyue.png" alt="" class="logo"> <!----></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/vue/v2/overview/" class="nav-link">
  Vue 2
</a></div><div class="nav-item"><a href="/docs/manual/" class="nav-link router-link-active">
  çŸ¥è¯†æ‰‹å†Œ
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs/vue/v2/overview/" class="nav-link">
  Vue 2
</a></div><div class="nav-item"><a href="/docs/manual/" class="nav-link router-link-active">
  çŸ¥è¯†æ‰‹å†Œ
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>JavaScript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/manual/javascript/" class="sidebar-link">çŸ¥è¯†æ¦‚è¦</a></li><li><a href="/docs/manual/javascript/ctx.html" class="sidebar-link">æ‰§è¡Œä¸Šä¸‹æ–‡</a></li><li><a href="/docs/manual/javascript/scope.html" class="sidebar-link">ä½œç”¨åŸŸ</a></li><li><a href="/docs/manual/javascript/closure.html" class="sidebar-link">é—­åŒ…</a></li><li><a href="/docs/manual/javascript/this.html" class="sidebar-link">this</a></li><li><a href="/docs/manual/javascript/promise.html" class="sidebar-link">Promise</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>æµè§ˆå™¨</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/manual/browser/process.html" class="sidebar-link">å¤šè¿›ç¨‹æ¶æ„</a></li><li><a href="/docs/manual/browser/render.html" class="sidebar-link">æ¸²æŸ“æµç¨‹</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>å‰åç«¯æ¡†æ¶</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/manual/framework/express.html" class="sidebar-link">Express</a></li><li><a href="/docs/manual/framework/koa.html" class="sidebar-link">Koa</a></li><li><a href="/docs/manual/framework/egg.html" class="sidebar-link">Egg</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>å‰ç«¯å·¥ç¨‹åŒ–</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/manual/engineering/" aria-current="page" class="sidebar-link">å·¥ç¨‹åŒ–</a></li><li><a href="/docs/manual/engineering/babel.html" class="sidebar-link">Babel</a></li><li><a href="/docs/manual/engineering/wp.html" aria-current="page" class="active sidebar-link">Webpack</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/manual/engineering/wp.html#å·¥ä½œæµç¨‹" class="sidebar-link">å·¥ä½œæµç¨‹</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/manual/engineering/wp.html#_1-create-compiler" class="sidebar-link">1. create compiler</a></li><li class="sidebar-sub-header"><a href="/docs/manual/engineering/wp.html#_2-run-watch" class="sidebar-link">2. run/watch</a></li><li class="sidebar-sub-header"><a href="/docs/manual/engineering/wp.html#_3-compilation" class="sidebar-link">3. compilation</a></li><li class="sidebar-sub-header"><a href="/docs/manual/engineering/wp.html#_4-emit" class="sidebar-link">4. emit</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/manual/engineering/wp.html#loader" class="sidebar-link">loader</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/manual/engineering/wp.html#loader-runner" class="sidebar-link">loader-runner</a></li><li class="sidebar-sub-header"><a href="/docs/manual/engineering/wp.html#loader-raw" class="sidebar-link">loader.raw</a></li><li class="sidebar-sub-header"><a href="/docs/manual/engineering/wp.html#loader-pitch" class="sidebar-link">loader.pitch</a></li><li class="sidebar-sub-header"><a href="/docs/manual/engineering/wp.html#loader-normal" class="sidebar-link">loader.normal</a></li><li class="sidebar-sub-header"><a href="/docs/manual/engineering/wp.html#loader-åˆ†ç±»" class="sidebar-link">loader åˆ†ç±»</a></li><li class="sidebar-sub-header"><a href="/docs/manual/engineering/wp.html#styleloader-pitch" class="sidebar-link">styleLoader.pitch</a></li><li class="sidebar-sub-header"><a href="/docs/manual/engineering/wp.html#pitch-çš„åä¸‡ä¸ªä¸ºä»€ä¹ˆ" class="sidebar-link">pitch çš„åä¸‡ä¸ªä¸ºä»€ä¹ˆ</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/manual/engineering/wp.html#plugin" class="sidebar-link">plugin</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/manual/engineering/wp.html#åŸºæœ¬ç»“æ„" class="sidebar-link">åŸºæœ¬ç»“æ„</a></li><li class="sidebar-sub-header"><a href="/docs/manual/engineering/wp.html#å¦‚ä½•ä½¿ç”¨" class="sidebar-link">å¦‚ä½•ä½¿ç”¨</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/manual/engineering/wp.html#rebuild-hmr" class="sidebar-link">Rebuild &amp; HMR</a></li><li class="sidebar-sub-header"><a href="/docs/manual/engineering/wp.html#æ–‡ä»¶æŒ‡çº¹" class="sidebar-link">æ–‡ä»¶æŒ‡çº¹</a></li><li class="sidebar-sub-header"><a href="/docs/manual/engineering/wp.html#è¾“å‡ºç»“æ„" class="sidebar-link">è¾“å‡ºç»“æ„</a></li><li class="sidebar-sub-header"><a href="/docs/manual/engineering/wp.html#source-map" class="sidebar-link">source map</a></li><li class="sidebar-sub-header"><a href="/docs/manual/engineering/wp.html#åŸºæœ¬éœ€æ±‚" class="sidebar-link">åŸºæœ¬éœ€æ±‚</a></li><li class="sidebar-sub-header"><a href="/docs/manual/engineering/wp.html#æ€»ç»“" class="sidebar-link">æ€»ç»“</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>ç½‘ç»œ</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/manual/networking/" class="sidebar-link">çŸ¥è¯†æ¦‚è¦</a></li><li><a href="/docs/manual/networking/http.html" class="sidebar-link">HTTP</a></li><li><a href="/docs/manual/networking/cache.html" class="sidebar-link">HTTP ç¼“å­˜</a></li><li><a href="/docs/manual/networking/dhcp.html" class="sidebar-link">DHCP</a></li><li><a href="/docs/manual/networking/icmp.html" class="sidebar-link">ICMP</a></li><li><a href="/docs/manual/networking/tcp.html" class="sidebar-link">TCP</a></li></ul></section></li><li><a href="/docs/manual/perfomance/" class="sidebar-link">æ€§èƒ½ä¼˜åŒ–</a></li><li><a href="/docs/manual/security/" class="sidebar-link">Web å®‰å…¨</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="webpack"><a href="#webpack" class="header-anchor">#</a> Webpack</h1> <p>Webpack çš„å·¥ä½œæµç¨‹åŠ loader, plugin ç­‰çš„åŸç†ï¼Œç»“æ„åˆ†æã€‚</p> <h2 id="å·¥ä½œæµç¨‹"><a href="#å·¥ä½œæµç¨‹" class="header-anchor">#</a> å·¥ä½œæµç¨‹</h2> <p>Webpack çš„å·¥ä½œæµç¨‹å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªäº‹ä»¶æµæœºåˆ¶ï¼Œæ¯ä¸€ä¸ªäº‹ä»¶ä¸Šå¯ä»¥æ³¨å†Œäº‹ä»¶å¤„ç†å‡½æ•°ï¼Œæ³¨å†Œå¤„ç†å‡½æ•°çš„æ–¹å¼æ˜¯æ’ä»¶ã€‚
Webpack çš„äº‹ä»¶æµåŸºäº <a href="https://github.com/webpack/tapable" target="_blank" rel="noopener noreferrer">Tapable<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> å®ç°ã€‚Tapable ç±»ä¼¼äº EventEmitterï¼Œæˆ–è€…æ›´ç®€å•çš„ <a href="https://github.com/developit/mitt" target="_blank" rel="noopener noreferrer">mitt<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ï¼Œæ˜¯ä¸€ä¸ªäº‹ä»¶å‘å¸ƒ/è®¢é˜…çš„å·¥å…·ã€‚ä¸€ä¸ªç®€å•ç¤ºä¾‹å¦‚ä¸‹</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> SyncHook <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'tapable'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// å®šä¹‰ hooks</span>
<span class="token keyword">class</span> <span class="token class-name">Car</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks <span class="token operator">=</span> <span class="token punctuation">{</span>
      accelerate<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;newSpeed&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      brake<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      calculateRoutes<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">AsyncParallelHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;source&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;target&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;routesList&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> myCar <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Car</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// æ³¨å†Œé’©å­å‡½æ•°</span>
myCar<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>brake<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// è§¦å‘äº‹ä»¶</span>
myCar<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">brake</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>æä¾›äº†æ–¹æ³•è¿›è¡Œäº‹ä»¶è®¢é˜…ï¼Œäº‹ä»¶å‘å¸ƒï¼Œé€šè¿‡å®šä¹‰ hooks å±æ€§ï¼ŒCar çš„å®ä¾‹å…·å¤‡äº†æ¶ˆæ¯å‘å¸ƒ/è®¢é˜…çš„èƒ½åŠ›ã€‚</p> <p>æœ¬æ–‡è·³è¿‡å…¥å£æŸ¥æ‰¾çš„è¿‡ç¨‹ï¼Œç›´æ¥ä» Webpack çš„å®ä¾‹åŒ–å¼€å§‹ã€‚å¦‚æœæŠŠ Webpack å½“åšä¸€ä¸ªç±»ä¼¼äº Vue è¿™æ ·çš„æ„é€ å‡½æ•°ï¼Œå¤§æ¦‚å¯ä»¥è®¤ä¸º</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>compiler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Webpack</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>è™½ä¸ä¸­ï¼Œäº¦ä¸è¿œçŸ£ã€‚compiler æ˜¯ Webpack ä¸­çš„ä¸¤ä¸ªæ ¸å¿ƒå¯¹è±¡ä¹‹ä¸€ï¼Œè´Ÿè´£æ•´ä¸ªæ„å»ºè¿‡ç¨‹çš„è°ƒåº¦å’ŒçŠ¶æ€ç»´æŠ¤ã€‚å¦ä¸€ä¸ªæ ¸å¿ƒå¯¹è±¡æ˜¯ compilationï¼Œè¡¨ç¤ºç¼–è¯‘ï¼Œè´Ÿè´£ä¸€æ¬¡å…·ä½“çš„ç¼–è¯‘è¿‡ç¨‹ã€‚
å¦‚æœç”¨ Node æœåŠ¡åšä¸ªå¯¹æ¯”ï¼Œcompiler å°±åƒ node processï¼Œè€Œ compilation åªæ˜¯ä¸€æ¬¡è¯·æ±‚çš„å¤„ç†è¿‡ç¨‹ï¼Œæ˜¯ ctxã€‚Webpack çš„å·¥ä½œæµç¨‹ï¼Œå°±å›´ç»•ç€è¿™ä¸¤ä¸ªå¯¹è±¡å±•å¼€ã€‚</p> <h3 id="_1-create-compiler"><a href="#_1-create-compiler" class="header-anchor">#</a> 1. create compiler</h3> <p>webpack å®šä¹‰åœ¨<code>lib/webpack.js</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">webpack</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">options<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> compiler <span class="token operator">=</span> <span class="token function">createCompiler</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">return</span> compiler<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>createCompiler</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">createCompiler</span> <span class="token operator">=</span> <span class="token parameter">options</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// è®¾ç½®é»˜è®¤å€¼ï¼Œæ¯”å¦‚è¯´å¦‚æœæ²¡é…ç½® options.targetï¼Œå°±è®¾ç½® options.target ä¸º web</span>
  options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebpackOptionsDefaulter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// åˆå§‹åŒ– compiler</span>
  <span class="token keyword">const</span> compiler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Compiler</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
  compiler<span class="token punctuation">.</span>options <span class="token operator">=</span> options<span class="token punctuation">;</span>

  <span class="token comment">// å†…ç½®æ’ä»¶å®ä¾‹åŒ–å¹¶è°ƒç”¨</span>
  <span class="token keyword">new</span> <span class="token class-name">NodeEnvironmentPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    infrastructureLogging<span class="token operator">:</span> options<span class="token punctuation">.</span>infrastructureLogging
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// plugins è°ƒç”¨</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>plugins<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> plugin <span class="token keyword">of</span> options<span class="token punctuation">.</span>plugins<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> plugin <span class="token operator">===</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">plugin</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>compiler<span class="token punctuation">,</span> compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">plugin</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// å‘å¸ƒç¯å¢ƒçŠ¶æ€äº‹ä»¶</span>
  compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">environment</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">afterEnvironment</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// æ ¹æ® options è®¾ç½®æ’ä»¶</span>
  compiler<span class="token punctuation">.</span>options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebpackOptionsApply</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> compiler<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>è¿™é‡Œçš„å†…å®¹å¾ˆå¤šï¼Œå·²ç»åœ¨ä»£ç ä¸­åšäº†ç®€è¦æ³¨é‡Šã€‚ç†è§£ hooks å’Œ plugin ç›¸å…³çš„åˆå§‹åŒ–ï¼Œå¯¹äºç†è§£ Webpack å·¥ä½œæµç¨‹è‡³å…³é‡è¦ã€‚</p> <ul><li>å®ä¾‹åŒ– Compiler</li> <li>æ‰§è¡Œ plugins</li> <li>å‘å¸ƒç¯å¢ƒäº‹ä»¶</li> <li>æ ¹æ® options è®¾ç½®æ’ä»¶</li></ul> <p>é€æ­¥æ¥çœ‹å…¶ä¸­çš„å†…å®¹</p> <h4 id="å®ä¾‹åŒ–-compiler"><a href="#å®ä¾‹åŒ–-compiler" class="header-anchor">#</a> å®ä¾‹åŒ– Compiler</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code>compiler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Compiler</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>æ¥çœ‹ä¸€ä¸‹ Compiler çš„å®šä¹‰</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span>
  SyncHook<span class="token punctuation">,</span>
  SyncBailHook<span class="token punctuation">,</span>
  AsyncParallelHook<span class="token punctuation">,</span>
  AsyncSeriesHook
<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;tapable&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Compiler</span> <span class="token punctuation">{</span>
  <span class="token comment">/**
   * @param {string} context the compilation path
   */</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">freeze</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      shouldEmit<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">SyncBailHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;compilation&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      done<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">AsyncSeriesHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;stats&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token comment">/** @type {SyncHook&lt;[Stats]&gt;} */</span>
      afterDone<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;stats&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token comment">/** @type {AsyncSeriesHook&lt;[]&gt;} */</span>
      additionalPass<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">AsyncSeriesHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token comment">/** @type {AsyncSeriesHook&lt;[Compiler]&gt;} */</span>
      beforeRun<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">AsyncSeriesHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;compiler&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token comment">/** @type {AsyncSeriesHook&lt;[Compiler]&gt;} */</span>
      run<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">AsyncSeriesHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;compiler&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token comment">/** @type {AsyncSeriesHook&lt;[Compilation]&gt;} */</span>
      emit<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">AsyncSeriesHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;compilation&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token comment">/** @type {AsyncSeriesHook&lt;[string, AssetEmittedInfo]&gt;} */</span>
      assetEmitted<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">AsyncSeriesHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;file&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;info&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token comment">/** @type {AsyncSeriesHook&lt;[Compilation]&gt;} */</span>
      afterEmit<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">AsyncSeriesHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;compilation&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token comment">// ...çœç•¥å…¶ä»– hooks å®šä¹‰</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// ...ä¸€å †å±æ€§åˆå§‹åŒ–</span>
  <span class="token punctuation">}</span>

  <span class="token function">watch</span><span class="token punctuation">(</span><span class="token parameter">watchOptions<span class="token punctuation">,</span> handler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>

  <span class="token function">run</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// ...</span>

  <span class="token function">compile</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>

  <span class="token function">close</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>cache<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br></div></div><p>æ„é€ å‡½æ•°ä¸­ <code>context</code> å‚æ•°æ˜¯ç¼–è¯‘è·¯å¾„ï¼Œæ¯”å¦‚<code>/abs/path/to/webpack-demo</code>ã€‚
compiler.hooks ä½¿ç”¨ tapable å¯¼å‡ºçš„å·¥å…·å‡½æ•°è¿›è¡Œäº†ä¼—å¤šäº‹ä»¶çš„å®šä¹‰ï¼Œç”±æ­¤ compiler å…·å¤‡äº†äº‹ä»¶å‘å¸ƒ/è®¢é˜…çš„èƒ½åŠ›ã€‚</p> <p>æ€»ä¹‹ <code>new Compiler</code>ï¼Œå°±æ˜¯ä½¿ç”¨ tapable ç»™ compiler å®ä¾‹å®šä¹‰äº†è¯¸å¤šç¼–è¯‘å™¨æ‰§è¡Œç›¸å…³çš„äº‹ä»¶ã€‚</p> <h4 id="æ‰§è¡Œ-plugins"><a href="#æ‰§è¡Œ-plugins" class="header-anchor">#</a> æ‰§è¡Œ plugins</h4> <p><span class="go-on" data-v-da9f1928>
  ğŸ‘¨â€ğŸ’»â€<sub data-v-da9f1928> Go On... </sub>ğŸ‘¨â€ğŸ’»â€Â 
</span>ä¸‹é¢è¿™ä¸¤å—å†…å®¹ï¼Œéƒ½æ˜¯æ’ä»¶çš„è°ƒç”¨</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">createCompiler</span> <span class="token operator">=</span> <span class="token parameter">options</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">new</span> <span class="token class-name">NodeEnvironmentPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    infrastructureLogging<span class="token operator">:</span> options<span class="token punctuation">.</span>infrastructureLogging
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>plugins<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> plugin <span class="token keyword">of</span> options<span class="token punctuation">.</span>plugins<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> plugin <span class="token operator">===</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">plugin</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>compiler<span class="token punctuation">,</span> compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">plugin</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>æ’ä»¶çš„è°ƒç”¨å…¶å®å°±æ˜¯æ³¨å†Œäº‹ä»¶å¤„ç†å‡½æ•°ï¼Œä¸ç®¡æ˜¯ NodeEnvironmentPlugin è¿˜æ˜¯ options.plugins é‡Œé¢ä¼ å…¥çš„æ’ä»¶ï¼Œéƒ½æ˜¯ä¸€æ ·çš„ã€‚
ä»¥è¿™é‡Œçš„ <code>NodeEnvironmentPlugin</code> ä¸ºä¾‹</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">NodeEnvironmentPlugin</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> options <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>beforeRun<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">&quot;NodeEnvironmentPlugin&quot;</span><span class="token punctuation">,</span> <span class="token parameter">compiler</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>compiler<span class="token punctuation">.</span>inputFileSystem <span class="token operator">===</span> inputFileSystem<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        inputFileSystem<span class="token punctuation">.</span><span class="token function">purge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>å‰é¢<code>new Compiler</code> å®šä¹‰äº† <code>beforeRun</code> äº‹ä»¶ï¼Œè¿™é‡Œå°±æ˜¯ç»™<code>beforeRun</code>æ·»åŠ ä¸€ä¸ªè®¢é˜…å‡½æ•°è€Œå·²ã€‚</p> <h4 id="å‘å¸ƒç¯å¢ƒäº‹ä»¶"><a href="#å‘å¸ƒç¯å¢ƒäº‹ä»¶" class="header-anchor">#</a> å‘å¸ƒç¯å¢ƒäº‹ä»¶</h4> <p><span class="go-on" data-v-da9f1928>
  ğŸ‘¨â€ğŸ’»â€<sub data-v-da9f1928> Go On... </sub>ğŸ‘¨â€ğŸ’»â€Â 
</span> åœ¨å®šä¹‰äº†äº‹ä»¶ï¼Œä¹Ÿæ·»åŠ äº†ä¸€äº›è®¢é˜…äº‹ä»¶ä¹‹åï¼Œæ˜¯å†…ç½®çš„ç¯å¢ƒç›¸å…³äº‹ä»¶çš„å‘å¸ƒï¼Œå¦‚ä¸‹</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">createCompiler</span> <span class="token operator">=</span> <span class="token parameter">options</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...å‘å¸ƒç¯å¢ƒçŠ¶æ€ç›¸å…³çš„äº‹ä»¶</span>
  compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">environment</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">afterEnvironment</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// æ ¹æ®options è®¾ç½®æ’ä»¶</span>
  compiler<span class="token punctuation">.</span>options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebpackOptionsApply</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> compiler<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="æ ¹æ®-options-è®¾ç½®æ’ä»¶"><a href="#æ ¹æ®-options-è®¾ç½®æ’ä»¶" class="header-anchor">#</a> æ ¹æ® options è®¾ç½®æ’ä»¶</h4> <p>åˆ›å»ºç¼–è¯‘å™¨çš„æœ€åæ˜¯æ ¹æ®ä¼ é€’çš„ optionsï¼Œæˆ–è€…è¯´æˆ‘ä»¬ç¼–å†™çš„ webpack.config.js ä¸­çš„é…ç½®ï¼Œå»è®¾ç½®æ’ä»¶ã€‚å¦‚ä¸‹</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">createCompiler</span> <span class="token operator">=</span> <span class="token parameter">options</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  compiler<span class="token punctuation">.</span>options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebpackOptionsApply</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>è¿™æ˜¯ä¸€ä¸ªé‡è¦çš„åˆå§‹åŒ–ï¼Œå®ƒè´Ÿè´£å°† options å‚æ•°ï¼Œè½¬æ¢ä¸º Webpack å†…éƒ¨æ’ä»¶æ¥å¤„ç†ï¼Œéƒ¨åˆ†å†…å®¹å¦‚ä¸‹</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">WebpackOptionsApply</span> <span class="token keyword">extends</span> <span class="token class-name">OptionsApply</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">process</span><span class="token punctuation">(</span><span class="token parameter">options<span class="token punctuation">,</span> compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token keyword">new</span> <span class="token class-name">EntryOptionPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>compiler<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åœ¨è¿™é‡Œå¯¹ entry å¤šç§é…ç½®å½¢å¼è¿›è¡Œäº†ç»Ÿä¸€å¤„ç†è½¬æ¢</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">entryOption</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>context<span class="token punctuation">,</span> options<span class="token punctuation">.</span>entry<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ...</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> options<span class="token punctuation">.</span>mode <span class="token operator">!==</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> WarnNoModeSetPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./WarnNoModeSetPlugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">new</span> <span class="token class-name">WarnNoModeSetPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>optimization<span class="token punctuation">.</span>removeAvailableModules<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> RemoveParentModulesPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./optimize/RemoveParentModulesPlugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">new</span> <span class="token class-name">RemoveParentModulesPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>optimization<span class="token punctuation">.</span>removeEmptyChunks<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> RemoveEmptyChunksPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./optimize/RemoveEmptyChunksPlugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">new</span> <span class="token class-name">RemoveEmptyChunksPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ...</span>
    <span class="token keyword">return</span> options<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>ä»¥ä¸Šåªå±•ç¤ºäº†åŸä»£ç çš„ä¸€å°éƒ¨åˆ†å†…å®¹ã€‚æ¦‚æ‹¬æ¥è¯´ï¼Œè¿™å°±æ˜¯æ ¹æ® options ä¸­çš„å‚æ•°é…ç½®ï¼Œå¼•å…¥ä¸€ä¸ªä¸ªå†…éƒ¨æä¾›çš„æ’ä»¶è¿›è¡Œå¤„ç†ã€‚åŸºæœ¬ä¸Šæ˜¯ä¸‹é¢è¿™æ ·çš„ä¸€ä¸ªè½¬æ¢</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>someplugin<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> Plugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./relative/path/to/someplugin'</span><span class="token punctuation">)</span>ï¼›
  <span class="token keyword">new</span> <span class="token class-name">Plugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><span bold="" class="bold" data-v-2a0a1bb2>æ€»ç»“æ¥è¯´ï¼Œæ•´ä¸ª compiler åˆå§‹åŒ–çš„è¿‡ç¨‹ï¼Œéƒ½å›´ç»•ç€ hooks å’Œ pluginsï¼Œå®šä¹‰äº‹ä»¶ï¼Œè®¢é˜…äº‹ä»¶ã€‚
options é…ç½®å’Œæ’ä»¶æ˜¯æœ‰å¯¹åº”å…³ç³»çš„ï¼Œä¼šå°†å‚æ•°é…ç½®è½¬æ¢ä¸º plugin å»å¤„ç†ã€‚</span></p> <h3 id="_2-run-watch"><a href="#_2-run-watch" class="header-anchor">#</a> 2. run/watch</h3> <p>åˆ›å»ºäº† compiler ä¹‹åï¼Œå°±æ˜¯å¼€å§‹ç¼–è¯‘äº†</p> <div class="language-js line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><div class="highlighted">Â </div><br><br><br><br><br><br><br><br><br></div><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">webpack</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">options<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  compiler <span class="token operator">=</span> <span class="token function">createCompiler</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
  watch <span class="token operator">=</span> options<span class="token punctuation">.</span>watch<span class="token punctuation">;</span>
  watchOptions <span class="token operator">=</span> options<span class="token punctuation">.</span>watchOptions <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>watch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      compiler<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span>watchOptions<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      compiler<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> stats</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        compiler<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token parameter">err2</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token function">callback</span><span class="token punctuation">(</span>err <span class="token operator">||</span> err2<span class="token punctuation">,</span> stats<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> compiler<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>åˆ¤æ–­æ˜¯å¦æ˜¯ watch æ¨¡å¼æ‰§è¡Œ compiler.watch æˆ–è€… compiler.runï¼Œwatch æ¨¡å¼æ˜¯ dev ç›¸å…³çš„ï¼Œç ”ç©¶ run å³å¯</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Compiler</span> <span class="token punctuation">{</span>
  <span class="token comment">/**
   * @param {string} context the compilation path
   */</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">run</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>cache<span class="token punctuation">.</span><span class="token function">endIdle</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">finalCallback</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>beforeRun<span class="token punctuation">.</span><span class="token function">callAsync</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">finalCallback</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>run<span class="token punctuation">.</span><span class="token function">callAsync</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">finalCallback</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>

          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">readRecords</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">finalCallback</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span>onCompiled<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>ä»ä¸Šé¢çœ‹ï¼Œä¾æ¬¡è§¦å‘<code>beforeRun</code>ï¼Œ<code>run</code>ä¸¤ä¸ªäº‹ä»¶ï¼Œæœ€ç»ˆè°ƒç”¨ compile å‡½æ•°ï¼Œcompile è¡¨ç¤ºä¸€æ¬¡ç¼–è¯‘ã€‚onCompiled è¿™ä¸ªå›è°ƒå‡½æ•°æ˜¯ç¼–è¯‘å®Œæˆä¹‹åæ‰§è¡Œçš„ã€‚</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">compile</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> params <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">newCompilationParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>beforeCompile<span class="token punctuation">.</span><span class="token function">callAsync</span><span class="token punctuation">(</span>params<span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> compilation <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">newCompilation</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> logger <span class="token operator">=</span> compilation<span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token string">&quot;webpack.Compiler&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    logger<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">&quot;make hook&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>make<span class="token punctuation">.</span><span class="token function">callAsync</span><span class="token punctuation">(</span>compilation<span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      logger<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">&quot;make hook&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>

      process<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">&quot;finish compilation&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        compilation<span class="token punctuation">.</span><span class="token function">finish</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          logger<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">&quot;finish compilation&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>

          logger<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">&quot;seal compilation&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          compilation<span class="token punctuation">.</span><span class="token function">seal</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            logger<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">&quot;seal compilation&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>

            logger<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">&quot;afterCompile hook&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>afterCompile<span class="token punctuation">.</span><span class="token function">callAsync</span><span class="token punctuation">(</span>compilation<span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              logger<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">&quot;afterCompile hook&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>

              <span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> compilation<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><p>ä»¥ä¸Šä¾æ¬¡è§¦å‘äº† beforeCompile, compile, makeï¼Œè€Œ hooks.make å³å¼€å§‹ç¼–è¯‘ã€‚
ä»è°ƒç”¨ compiler.run åˆ° hooks.makeï¼ŒåŸºæœ¬ä¸Šéƒ½åªæ˜¯åœ¨åšå„ä¸ªç»†åˆ†äº‹ä»¶çš„è§¦å‘ï¼Œæœ‰ç‚¹åƒ DOM äº‹ä»¶çš„æ•è·çš„è¿‡ç¨‹ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½é€šçŸ¥ä¸€ä¸‹ï¼Œèµ°è¿‡åƒå±±ä¸‡æ°´ï¼Œå¥—è·¯ä¸‡åƒï¼Œåˆ°äº† make è·Ÿå‰ï¼Œæœ€åå¤§å“„ä¸€å£° â€”â€” ç°åœ¨è€å­çœŸçš„è¦å¼€å§‹äº†ã€‚</p> <p>å…·ä½“çš„ç¼–è¯‘ç”± compilationï¼Œcompilation æ˜¯ç¼–è¯‘æœ€æ ¸å¿ƒçš„è¿‡ç¨‹ï¼Œæ¯”è¾ƒå¤æ‚ï¼Œä½œä¸ºä¸€ä¸ªå•ç‹¬çš„ç¯èŠ‚å»åˆ†æã€‚
æ€»ä¹‹åœ¨è¿™é‡Œ make å®Œæˆä¹‹åï¼Œè¡¨ç¤ºæ–‡ä»¶å·²ç»è¿›è¡Œäº†ä¸€æ¬¡ç¼–è¯‘ï¼Œä¹‹åæ˜¯è°ƒç”¨ compilation.finish å’Œ compilation.seal å»åšä¸€äº›æ”¶å°¾å·¥ä½œã€‚</p> <h3 id="_3-compilation"><a href="#_3-compilation" class="header-anchor">#</a> 3. compilation</h3> <p>compilation è´Ÿè´£ä¸€æ¬¡å…·ä½“ç¼–è¯‘è¿‡ç¨‹ã€‚å…·ä½“çš„æ¨¡å—ç¼–è¯‘è°ƒåº¦ï¼Œcompilation æ ¹æ® entryï¼Œä½¿ç”¨ loader å¯¹æ¨¡å—è¿›è¡Œç¼–è¯‘ï¼Œç”Ÿæˆ bundleã€‚</p> <p>compiler.hooks.make çš„è§¦å‘æ˜¯ç¼–è¯‘çš„å‘ä»¤æªï¼Œé€šè¿‡æœç´¢ hooks.make.tap æ‰¾åˆ°å¯¹åº”çš„è®¢é˜…å‡½æ•°</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">grep</span> -rn hooks.make.tap ./lib
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>å¾—åˆ°</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">.</span><span class="token operator">/</span>lib<span class="token operator">/</span>AutomaticPrefetchPlugin<span class="token punctuation">.</span>js<span class="token operator">:</span>		compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>make<span class="token punctuation">.</span><span class="token function">tapAsync</span><span class="token punctuation">(</span>
<span class="token punctuation">.</span><span class="token operator">/</span>lib<span class="token operator">/</span>PrefetchPlugin<span class="token punctuation">.</span>js<span class="token operator">:</span>		compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>make<span class="token punctuation">.</span><span class="token function">tapAsync</span><span class="token punctuation">(</span><span class="token string">&quot;PrefetchPlugin&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">compilation<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="token punctuation">.</span><span class="token operator">/</span>lib<span class="token operator">/</span>EntryPlugin<span class="token punctuation">.</span>js<span class="token operator">:</span>		compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>make<span class="token punctuation">.</span><span class="token function">tapAsync</span><span class="token punctuation">(</span><span class="token string">&quot;EntryPlugin&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">compilation<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="token punctuation">.</span><span class="token operator">/</span>lib<span class="token operator">/</span>DynamicEntryPlugin<span class="token punctuation">.</span>js<span class="token operator">:</span>		compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>make<span class="token punctuation">.</span><span class="token function">tapAsync</span><span class="token punctuation">(</span>
<span class="token punctuation">.</span><span class="token operator">/</span>lib<span class="token operator">/</span>DllEntryPlugin<span class="token punctuation">.</span>js<span class="token operator">:</span>		compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>make<span class="token punctuation">.</span><span class="token function">tapAsync</span><span class="token punctuation">(</span><span class="token string">&quot;DllEntryPlugin&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">compilation<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>ç”±æ­¤å¯ä»¥å¾—çŸ¥ make å…·ä½“åšçš„äº‹æƒ…ï¼Œå°±åœ¨è¿™å‡ ä¸ªåœ°æ–¹æ³¨å†Œçš„è®¢é˜…å‡½æ•°é‡Œé¢ã€‚
æˆ‘ä»¬ç ”ç©¶ EntryPlugin.js(è¾ƒæ—©ç‰ˆæœ¬é‡Œé¢æ˜¯ SingleEntryPlugin.js)ï¼Œè¿™ä¸ªæ’ä»¶æ˜¯ç”¨æ¥å¤„ç†é…ç½®çš„ entryï¼Œç¼–è¯‘è‡ªç„¶æ˜¯ä»å…¥å£å¼€å§‹å¤„ç†çš„</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> EntryDependency <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./dependencies/EntryDependency&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">EntryPlugin</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> entry<span class="token punctuation">,</span> name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>context <span class="token operator">=</span> context<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>entry <span class="token operator">=</span> entry<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>

    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>make<span class="token punctuation">.</span><span class="token function">tapAsync</span><span class="token punctuation">(</span><span class="token string">&quot;EntryPlugin&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">compilation<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> entry<span class="token punctuation">,</span> name<span class="token punctuation">,</span> context <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> dep <span class="token operator">=</span> EntryPlugin<span class="token punctuation">.</span><span class="token function">createDependency</span><span class="token punctuation">(</span>entry<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å°†åœ¨webpack.config.js ä¸­çš„entryæ–‡ä»¶è½¬æ¢ä¸ºä¸€ä¸ªæè¿°å¯¹è±¡</span>
      compilation<span class="token punctuation">.</span><span class="token function">addEntry</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> dep<span class="token punctuation">,</span> name<span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">callback</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> <span class="token function">createDependency</span><span class="token punctuation">(</span><span class="token parameter">entry<span class="token punctuation">,</span> name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> dep <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EntryDependency</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span><span class="token punctuation">;</span>
    dep<span class="token punctuation">.</span>loc <span class="token operator">=</span> <span class="token punctuation">{</span> name <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> dep<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>è¿™é‡Œçš„ entry å·²ç»æ˜¯å•ä¸ªæ–‡ä»¶ï¼Œæ˜¯åœ¨ compiler åˆå§‹åŒ–è¿‡ç¨‹ä¸­å·²ç»å¤„ç†è¿‡çš„ï¼Œé€šè¿‡ addEntry å¼€å§‹ç¼–è¯‘å…·ä½“æ–‡ä»¶</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">addEntry</span><span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> entry<span class="token punctuation">,</span> name<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">addEntry</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>entry<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> entriesArray <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>entryDependencies<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>entriesArray <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    entriesArray <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>entryDependencies<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> entriesArray<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  entriesArray<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addModuleChain</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> entry<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> module</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">failedEntry</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>entry<span class="token punctuation">,</span> name<span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">succeedEntry</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>entry<span class="token punctuation">,</span> name<span class="token punctuation">,</span> module<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> module<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>ä»¥ entry ä½œä¸ºç¬¬ä¸€ä¸ªæ¨¡å—å¼€å§‹æ„å»ºï¼Œåœ¨ addModuleChain çš„å›è°ƒå‡½æ•°ä¸­è§¦å‘äº† succeedEntry äº‹ä»¶ï¼Œè¿™è¯´æ˜åœ¨å›è°ƒæ‰§è¡Œæ—¶å½“å‰ entry å·²ç»æ„å»ºå®Œæˆã€‚
<br></p> <p>ä¸­é—´è¿‡ç¨‹å…¶å®æ¯”è¾ƒå¤æ‚ï¼Œæ¶‰åŠåˆ°ä¾èµ–çš„åˆ†ç±»ï¼ŒNormalModule å’Œ ContextModule ä¸åŒæ„é€ æ–¹æ³•ç­‰ç­‰ï¼Œè¿™äº›å†…å®¹è¿‡ç»†äº†ã€‚ä¸¾æœ€å¸¸è§çš„ä¾‹å­æ¥è¯´ï¼Œåœ¨æ¨¡å—æ„å»ºè¿‡ç¨‹ä¸­ï¼Œä¼šè°ƒç”¨å†…ç½®çš„ NormalModule æ„é€ å‡½æ•°å»ç”Ÿæˆæ¨¡å—å®ä¾‹ï¼Œæ¨¡å—å®ä¾‹ä¼šè¢«ä¿å­˜åˆ° compilation.modules æ•°ç»„é‡Œé¢ï¼Œç„¶åæ‰§è¡Œæ¨¡å—çš„ build æ–¹æ³•</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> getContext<span class="token punctuation">,</span> runLoaders <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;loader-runner&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">NormalModule</span> <span class="token keyword">extends</span> <span class="token class-name">Module</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">doBuild</span><span class="token punctuation">(</span><span class="token parameter">options<span class="token punctuation">,</span> compilation<span class="token punctuation">,</span> resolver<span class="token punctuation">,</span> fs<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token function">runLoaders</span><span class="token punctuation">(</span>
      <span class="token punctuation">{</span>
        resource<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>resource<span class="token punctuation">,</span>
        loaders<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>loaders<span class="token punctuation">,</span>
        context<span class="token operator">:</span> loaderContext<span class="token punctuation">,</span>
        readResource<span class="token operator">:</span> fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>fs<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">build</span><span class="token punctuation">(</span><span class="token parameter">options<span class="token punctuation">,</span> compilation<span class="token punctuation">,</span> resolver<span class="token punctuation">,</span> fs<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>

    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">doBuild</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> compilation<span class="token punctuation">,</span> resolver<span class="token punctuation">,</span> fs<span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// ...</span>
      result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>parser<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_ast <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_source<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        current<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">,</span>
        module<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">,</span>
        compilation<span class="token operator">:</span> compilation<span class="token punctuation">,</span>
        options<span class="token operator">:</span> options
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">handleParseResult</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p>åœ¨ doBuild å‡½æ•°ä¸­ï¼Œè°ƒç”¨äº† runLoaders å»è¿è¡Œ loader å¯¹æ–‡ä»¶è¿›è¡Œå…·ä½“è½¬æ¢ã€‚å‡è®¾æœ‰è¿™æ ·ä¸€ä¸ª app.js ä½œä¸º entry</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token string">'./style.less'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">AGE</span> <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>loader é…ç½®å¦‚ä¸‹</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>rules<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    test<span class="token operator">:</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
    use<span class="token operator">:</span> <span class="token punctuation">{</span>
      loader<span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
      options<span class="token operator">:</span> <span class="token punctuation">{</span>
        presets<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">[</span><span class="token string">'@babel/preset-env'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> targets<span class="token operator">:</span> <span class="token string">&quot;defaults&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.less$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
    loader<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;style-loader&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;less-loader&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>é‚£ä¹ˆåœ¨ runLoaders è¿”å›çš„ç»“æœå¦‚ä¸‹</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token string">'import \'./style.less\';\nvar AGE = 100;'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>parser.parse</code>æ˜¯æ ¹æ®å½“å‰çš„ sourceï¼Œä½¿ç”¨ <a href="https://github.com/acornjs/acorn" target="_blank" rel="noopener noreferrer">acorn<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> è¿™ä¸ªè§£æå·¥å…·ï¼Œå»ç”Ÿæˆ ASTï¼Œæ ¹æ® AST æå–åˆ°è¿™ä¸ªæ¨¡å—çš„ä¾èµ–é¡¹ï¼Œç„¶åç»§ç»­é€’å½’æ‰§è¡Œæ¨¡å—çš„ç¼–è¯‘è¿‡ç¨‹ï¼Œç›´åˆ°æ‰€æœ‰çš„ä¾èµ–éƒ½å¤„ç†å®Œæˆã€‚æœ€ç»ˆæ•´ä¸ªä¾èµ–å¤„ç†å®Œæˆåï¼Œè¿›å…¥åˆ°æ¨¡å—çš„ seal ç¯èŠ‚ï¼Œseal æœ‰ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤</p> <ul><li>chunk ç”Ÿæˆï¼šåœ¨å‰é¢çš„æ­¥éª¤ä¸­ï¼Œå„æ¨¡å—å®ä¾‹ä¿å­˜åœ¨ compilation.modules ä¸Šï¼Œseal æ ¹æ® entry ç”Ÿæˆ chunkï¼Œç”Ÿæˆ chunk hash</li> <li>asset ç”Ÿæˆï¼šæ ¹æ® chunk ç”Ÿæˆ assetï¼Œåœ¨è¿™ä¸€æ­¥ï¼Œrequire ç­‰å¼•ç”¨è¢«è½¬æ¢ä¸ºä½¿ç”¨å†…ç½®çš„<code>__webpack_require__</code>å¼•ç”¨</li></ul> <p>asset å’Œ chunk çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿå‡è®¾æˆ‘ä½¿ç”¨ MiniCssExtractPlugin æå–äº† cssï¼Œé‚£ä¹ˆç¼–è¯‘ç»“æœå¦‚ä¸‹</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>        Asset      Size  Chunks             Chunk Names
app.bundle.js  <span class="token number">4.31</span> KiB     app  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  app
      app.css  <span class="token number">4.18</span> KiB     app  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  app
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>åœ¨sealé˜¶æ®µç”Ÿæˆçš„ compilation.assets å¯¹è±¡ï¼Œä¸æˆ‘ä»¬æœ€ç»ˆæ‰“åŒ…å‡ºæ¥çš„ Assetï¼Œåªå·®ä¸´é—¨ä¸€è„šçš„è¾“å‡ºã€‚</p> <h3 id="_4-emit"><a href="#_4-emit" class="header-anchor">#</a> 4. emit</h3> <p>compilation æ‰§è¡Œå®Œæˆä¹‹åï¼Œå†…å­˜ä¸­å·²ç»æœ‰å³å°†è¾“å‡ºçš„æ–‡ä»¶äº†ï¼Œä¿å­˜åœ¨ compilation.assetsï¼Œæå–å‡ºæ¥å†™åˆ°å¯¹åº”è¾“å‡ºæ–‡ä»¶å³å¯ã€‚</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>assets <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">'app.css'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    _source<span class="token operator">:</span> <span class="token punctuation">{</span>
      children<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          _value<span class="token operator">:</span> <span class="token string">'.hello {\n  color: red;\n}\n.hello .world {\n  color: blue;\n}\n'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">'\n'</span> 
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">'app.bundle.js'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h2 id="loader"><a href="#loader" class="header-anchor">#</a> loader</h2> <p>loader æœ¬èº«æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä¸»è¦ç”¨äºå¯¹æ¨¡å—çš„æºä»£ç è¿›è¡Œè½¬æ¢ï¼Œè¾“å‡ºè½¬æ¢çš„ç»“æœã€‚
Loader çš„å¦ä¸€ä¸ªä½œç”¨æ˜¯å°† JSï¼ŒJSON å¤–çš„æ–‡ä»¶ç±»å‹è½¬æ¢ä¸ºæœ‰æ•ˆçš„ JS æ¨¡å—ï¼Œæ­£å› å¦‚æ­¤æ‰å¯ä»¥æ·»åŠ åˆ°ä¾èµ–å›¾ä¸­ã€‚
loader çš„é…ç½®ç¤ºä¾‹å¦‚ä¸‹</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
  entry<span class="token operator">:</span> <span class="token string">'./app.js'</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    filename<span class="token operator">:</span> <span class="token string">'[name].bundle.js'</span><span class="token punctuation">,</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    publicPath<span class="token operator">:</span> <span class="token string">''</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;style-loader&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>æŒ‰ç…§å®˜æ–¹ <a href="https://webpack.js.org/concepts/loaders/" target="_blank" rel="noopener noreferrer">loaders ä»‹ç»<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> æ‰€è¯´ï¼Œ<strong>Loaders are evaluated/executed from right to left (or from bottom to top)</strong>ã€‚
loaders æ‰§è¡Œé¡ºåºæ˜¯å³åˆ°å·¦ï¼Œè¿™å…¶ä¸­å¿…æœ‰è¹Šè··ï¼Œè¿™æ¶‰åŠåˆ° loader æ˜¯å¦‚ä½•æ‰§è¡Œ(loader-runner)ï¼Œä»¥åŠ loader module è‡ªèº«ç»“æ„çš„é—®é¢˜äº†ã€‚</p> <h3 id="loader-runner"><a href="#loader-runner" class="header-anchor">#</a> loader-runner</h3> <p>webpack ä¸­ä½¿ç”¨ <a href="https://github.com/webpack/loader-runner#readme" target="_blank" rel="noopener noreferrer">loader-runner<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> æ¥æ‰§è¡Œ loaderã€‚
loader-runner å¯ä»¥åœ¨ webpack ä¸­ä½¿ç”¨ï¼Œä¹Ÿæä¾›äº†ç‹¬ç«‹çš„è¿è¡Œç¯å¢ƒï¼Œå¯ä»¥åœ¨ä¸å®‰è£… webpack çš„æƒ…å†µä¸‹è¿è¡Œï¼Œä»¥ä¾¿äºè¿›è¡Œ loader çš„å¼€å‘å’Œè°ƒè¯•ã€‚
å…¶æ ¸å¿ƒå‡½æ•°<code>runLoaders</code>çš„æ ¼å¼å¦‚ä¸‹</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> runLoaders <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;loader-runner&quot;</span><span class="token punctuation">;</span>

<span class="token function">runLoaders</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  resource<span class="token operator">:</span> <span class="token string">&quot;/abs/path/to/file.txt?query&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">// String: Absolute path to the resource (optionally including query string)</span>

  loaders<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;/abs/path/to/loader.js?query&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/abs/path/to/loader2.js?query&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// String[]: Absolute paths to the loaders (optionally including query string)</span>
  <span class="token comment">// {loader, options}[]: Absolute paths to the loaders with options object</span>

  context<span class="token operator">:</span> <span class="token punctuation">{</span> minimize<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// Additional loader context which is used as base context</span>

  <span class="token function-variable function">processResource</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">loaderContext<span class="token punctuation">,</span> resourcePath<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// Optional: A function to process the resource</span>
  <span class="token comment">// Must have signature function(context, path, function(err, buffer))</span>
  <span class="token comment">// By default readResource is used and the resource is added a fileDependency</span>

  readResource<span class="token operator">:</span> fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>fs<span class="token punctuation">)</span>
  <span class="token comment">// Optional: A function to read the resource</span>
  <span class="token comment">// Only used when 'processResource' is not provided</span>
  <span class="token comment">// Must have signature function(path, function(err, buffer))</span>
  <span class="token comment">// By default fs.readFile is used</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>loader çš„æ‰§è¡Œï¼Œè‡ªç„¶å¿…ä¸å¯å°‘çš„ç¯èŠ‚æ˜¯åŠ è½½ loader æ¨¡å—ï¼Œæ­¤å¤„çœç•¥å…·ä½“ä»£ç å®šä½çš„è¿‡ç¨‹ï¼Œæœ€ç»ˆåŠ è½½ loader æ¨¡å—çš„ä»£ç å¦‚ä¸‹</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">loadLoader</span><span class="token punctuation">(</span><span class="token parameter">loader<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> System <span class="token operator">===</span> <span class="token string">&quot;object&quot;</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> System<span class="token punctuation">.</span>import <span class="token operator">===</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    System<span class="token punctuation">.</span><span class="token function">import</span><span class="token punctuation">(</span>loader<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      loader<span class="token punctuation">.</span>normal <span class="token operator">=</span> <span class="token keyword">typeof</span> module <span class="token operator">===</span> <span class="token string">&quot;function&quot;</span> <span class="token operator">?</span> module <span class="token operator">:</span> module<span class="token punctuation">.</span>default<span class="token punctuation">;</span>
      loader<span class="token punctuation">.</span>pitch <span class="token operator">=</span> module<span class="token punctuation">.</span>pitch<span class="token punctuation">;</span>
      loader<span class="token punctuation">.</span>raw <span class="token operator">=</span> module<span class="token punctuation">.</span>raw<span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> loader<span class="token punctuation">.</span>normal <span class="token operator">!==</span> <span class="token string">&quot;function&quot;</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> loader<span class="token punctuation">.</span>pitch <span class="token operator">!==</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LoaderLoadingError</span><span class="token punctuation">(</span>
          <span class="token string">&quot;Module '&quot;</span> <span class="token operator">+</span> loader<span class="token punctuation">.</span>path <span class="token operator">+</span> <span class="token string">&quot;' is not a loader (must have normal or pitch function)&quot;</span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>å¯ä»¥çœ‹åˆ° loader module å¯¼å‡ºä¸»è¦æœ‰ pitch å’Œ raw ä¸¤ä¸ªå±æ€§ï¼Œå…¶ä¸­é»˜è®¤å¯¼å‡ºçš„å‡½æ•°ç§°ä¸º normalã€‚
ä»æ¡ä»¶åˆ¤æ–­å¯çŸ¥ï¼Œ<code>normal</code> å’Œ <code>pitch</code> å‡½æ•°è‡³å°‘è¦æœ‰ä¸€ä¸ªã€‚
æ ¹æ®ä»¥ä¸Šç»“æœï¼Œ<code>loader</code> å¯ä»¥è®¤ä¸ºæ˜¯ä¸‹é¢è¿™æ ·ä¸€ä¸ªç»“æ„</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
  normal<span class="token operator">?</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  pitch<span class="token operator">?</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  raw<span class="token operator">?</span><span class="token operator">:</span> <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="loader-raw"><a href="#loader-raw" class="header-anchor">#</a> loader.raw</h3> <p><code>raw</code>æ˜¯ä¸€ä¸ª<code>Boolean</code>ï¼ŒæŒ‡å®š loader æœŸæœ›çš„è¾“å…¥å†…å®¹çš„ç±»å‹ã€‚
é»˜è®¤æƒ…å†µä¸‹ï¼Œresource æ–‡ä»¶è¢«è½¬åŒ–ä¸ºä¸€ä¸ª <code>UTF-8</code> å­—ç¬¦ä¸²ä¼ é€’ç»™ loaderï¼Œloader çš„è¾“å…¥è¾“å‡ºæ˜¯ String æˆ–è€… Buffer</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">loader</span><span class="token punctuation">(</span><span class="token parameter">content<span class="token operator">:</span>String<span class="token operator">|</span>Buffer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><code>content</code> é»˜è®¤æ˜¯ä¸€ä¸ª<code>String</code>ã€‚
é€šè¿‡è®¾ç½®<code>raw</code>ä¸º <code>true</code>ï¼Œloader-runner å¯ä»¥æ ¹æ® loader çš„éœ€è¦ï¼Œå°†èµ„æºå­—ç¬¦ä¸²æˆ–è€…ä¸Šä¸€ä¸ª loader çš„æ‰§è¡Œç»“æœï¼Œè½¬æ¢ä¸ºå½“å‰ loader æ‰€éœ€çš„æ ¼å¼</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">convertArgs</span><span class="token punctuation">(</span><span class="token parameter">args<span class="token punctuation">,</span> raw</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>raw <span class="token operator">&amp;&amp;</span> Buffer<span class="token punctuation">.</span><span class="token function">isBuffer</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">utf8BufferToString</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>raw <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span>
    args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>è¿™ä¸ªå¯ä»¥é€šè¿‡ä¸€ä¸ªç®€å•çš„ loader æ¥éªŒè¯ï¼Œå¦‚ä¸‹<code>loader-a.js</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">loader</span><span class="token punctuation">(</span><span class="token parameter">content</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'typeof'</span><span class="token punctuation">,</span> <span class="token keyword">typeof</span> content<span class="token punctuation">,</span> content <span class="token keyword">instanceof</span> <span class="token class-name">Buffer</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>raw <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>è€Œ<code>runner.js</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> runLoaders <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;loader-runner&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token function">runLoaders</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  resource<span class="token operator">:</span> <span class="token string">&quot;./style.css&quot;</span><span class="token punctuation">,</span>
  loaders<span class="token operator">:</span> <span class="token punctuation">[</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./loader-a.js'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  readResource<span class="token operator">:</span> fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>fs<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// console.log(re)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>æ‰§è¡Œ<code>node runner.js</code>è¾“å‡ºå¦‚ä¸‹</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>typeof object true
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>å¸¸è§çš„ raw ä¸º true çš„ loader æœ‰ file-loader, url-loader ç­‰ï¼Œè¿™äº› loader éƒ½ä¸éœ€è¦å…³æ³¨æ–‡ä»¶å†…éƒ¨çš„è¯¦ç»†å†…å®¹ï¼Œä¸éœ€è¦è¿›è¡Œè¯­æ³•åˆ†æã€‚</p> <h3 id="loader-pitch"><a href="#loader-pitch" class="header-anchor">#</a> loader.pitch</h3> <p>loader å¯ä»¥å¯¼å‡ºä¸¤ä¸ªæ–¹æ³•ï¼Œpitch å’Œ defaultï¼Œå¦‚ <a href="https://webpack.js.org/api/loaders/#pitching-loader" target="_blank" rel="noopener noreferrer">Pitching Loader<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> æ‰€è¿°ï¼Œå½“é…ç½®äº†å¤šä¸ª loader çš„æ—¶å€™</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token comment">//...</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'a-loader'</span><span class="token punctuation">,</span> <span class="token string">'b-loader'</span><span class="token punctuation">,</span> <span class="token string">'c-loader'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>å‡è®¾è¿™äº› loader éƒ½æœ‰ pitch å’Œ default æ–¹æ³•ï¼Œæ‰§è¡Œçš„æ­¥éª¤æ˜¯ä¸‹é¢è¿™æ ·çš„</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token operator">|</span>- a-loader <span class="token variable"><span class="token variable">`</span>pitch<span class="token variable">`</span></span>
  <span class="token operator">|</span>- b-loader <span class="token variable"><span class="token variable">`</span>pitch<span class="token variable">`</span></span>
    <span class="token operator">|</span>- c-loader <span class="token variable"><span class="token variable">`</span>pitch<span class="token variable">`</span></span>
      <span class="token operator">|</span>- requested module is picked up as a dependency
    <span class="token operator">|</span>- c-loader normal execution
  <span class="token operator">|</span>- b-loader normal execution
<span class="token operator">|</span>- a-loader normal execution
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>è€Œå½“æŸä¸ª pitch è¿”å›äº†ä¸€ä¸ª module çš„æ—¶å€™ï¼Œæ‰§è¡Œæ­¥éª¤ç¤ºä¾‹å¦‚ä¸‹s</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token operator">|</span>- a-loader <span class="token variable"><span class="token variable">`</span>pitch<span class="token variable">`</span></span>
  <span class="token operator">|</span>- b-loader <span class="token variable"><span class="token variable">`</span>pitch<span class="token variable">`</span></span> returns a module
<span class="token operator">|</span>- a-loader normal execution
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>ç†è§£è¿™ä¸ªæ‰§è¡Œçš„é€»è¾‘å®¹æ˜“ï¼Œä½†æ˜¯å¯¹äºä½¿ç”¨ pitch çš„åŸå› ï¼Œå®˜æ–¹çš„æè¿°</p> <blockquote><p>There are some instances where the loader only cares about the metadata behind a request and can ignore the results of the previous loader.</p></blockquote> <p>è¿™ä¸ªæè¿°å¹¶ä¸å®¹æ˜“ç†è§£ï¼Œå¹¶ä¸èƒ½ä»ä¸­é¢†ä¼šåˆ°ç©¶ç«Ÿæ˜¯ä¸ºä»€ä¹ˆï¼Œä»¥åŠä½•æ—¶ä½¿ç”¨ï¼Œæ­£å¦‚ <a href="https://github.com/webpack/webpack/issues/360" target="_blank" rel="noopener noreferrer">issues #360æ‰€è¿°<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ï¼Œpitch å¹¶ä¸é‚£ä¹ˆå®¹æ˜“ç†è§£å’Œæè¿°ã€‚</p> <h3 id="loader-normal"><a href="#loader-normal" class="header-anchor">#</a> loader.normal</h3> <p>é€šè¿‡å’Œ pitch å¯¹æ¯”ï¼Œæ‰€è°“çš„ normal æ˜¯ä»€ä¹ˆæ„æ€å·²ç»å¾ˆæ˜ç¡®äº†ã€‚
æˆ‘ä»¬è¯´å¤šä¸ª loader çš„æ—¶å€™ï¼Œæ‰§è¡Œé¡ºåºæ˜¯ä»å³åˆ°å·¦ï¼Œå…¶å®æ˜¯åœ¨è¯´ loader çš„ normal æ–¹æ³•çš„æ‰§è¡Œé¡ºåºæ˜¯ä»å³åˆ°å·¦ã€‚</p> <h3 id="loader-åˆ†ç±»"><a href="#loader-åˆ†ç±»" class="header-anchor">#</a> loader åˆ†ç±»</h3> <p>Webpack å®˜æ–¹æ–‡æ¡£é‡Œé¢ï¼Œå¯¹äº loaderï¼Œå½“<code>raw</code>çš„å€¼ä¸º<code>true</code>æ—¶ï¼Œç§°ä¸º â€Raw Loaderâ€œï¼Œå½“ <code>pitch</code> æ–¹æ³•å­˜åœ¨æ—¶ï¼Œç§°ä¸ºâ€Pitching Loaderâ€œã€‚
æˆ‘è§‰å¾—è¿™æ ·çš„ç§°å‘¼å¯¹äºç†è§£å¹¶æ— å¸®åŠ©ï¼Œæˆ‘æ›´å€¾å‘äº <a href="https://stackoverflow.com/questions/55789849/how-style-loader-works-with-css-loader/55792756" target="_blank" rel="noopener noreferrer">Stack Overflow è¿™ä¸ªå›ç­”<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>çš„åŸå› </p> <blockquote><p>Note, there's no such thing as pitch loader, cus every loader can have a &quot;normal side&quot; and &quot;pitch side&quot;.</p></blockquote> <p>loader å°±æ˜¯ loaderï¼Œæ²¡æœ‰æ‰€è°“çš„ Raw Loader æˆ–è€… Pitching Loaderï¼Œraw åªæ˜¯å®ƒçš„ä¸€ä¸ªé…ç½®å±æ€§ï¼Œè€Œ pitch æˆ–è€… normalï¼Œæ˜¯ä¸€ä¸ª loader çš„å·¦å³æ‰‹è€Œå·²ã€‚</p> <h3 id="styleloader-pitch"><a href="#styleloader-pitch" class="header-anchor">#</a> styleLoader.pitch</h3> <p>style-loader å®šä¹‰äº† pitch æ–¹æ³•ï¼Œå¤§æ¦‚çœ‹ä¸€ä¸‹å…¶å®šä¹‰</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>loaderApi<span class="token punctuation">.</span><span class="token function-variable function">pitch</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">loader</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>injectType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'linkTag'</span><span class="token operator">:</span>
      <span class="token comment">// ... return someString;</span>
    <span class="token keyword">case</span> <span class="token string">'lazyStyleTag'</span><span class="token operator">:</span>
    <span class="token keyword">case</span> <span class="token string">'lazySingletonStyleTag'</span><span class="token operator">:</span>
      <span class="token comment">// ... return someString;</span>
    <span class="token keyword">case</span> <span class="token string">'styleTag'</span><span class="token operator">:</span>
    <span class="token keyword">case</span> <span class="token string">'singletonStyleTag'</span><span class="token operator">:</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token comment">// ...</span>
      <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>
        esModule
          <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">import api from </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>loaderUtils<span class="token punctuation">.</span><span class="token function">stringifyRequest</span><span class="token punctuation">(</span>
              <span class="token keyword">this</span><span class="token punctuation">,</span>
              <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">!</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'runtime/injectStylesIntoStyleTag.js'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
            <span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">;
            import content from </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>loaderUtils<span class="token punctuation">.</span><span class="token function">stringifyRequest</span><span class="token punctuation">(</span>
              <span class="token keyword">this</span><span class="token punctuation">,</span>
              <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">!!</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>request<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
            <span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">;
            var clonedContent = content;</span><span class="token template-punctuation string">`</span></span>
          <span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">var api = require(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>loaderUtils<span class="token punctuation">.</span><span class="token function">stringifyRequest</span><span class="token punctuation">(</span>
              <span class="token keyword">this</span><span class="token punctuation">,</span>
              <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">!</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'runtime/injectStylesIntoStyleTag.js'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
            <span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">);
            var content = require(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>loaderUtils<span class="token punctuation">.</span><span class="token function">stringifyRequest</span><span class="token punctuation">(</span>
              <span class="token keyword">this</span><span class="token punctuation">,</span>
              <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">!!</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>request<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
            <span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">);

            content = content.__esModule ? content.default : content;

            if (typeof content === 'string') {
              content = [[module.id, content, '']];
            }</span><span class="token template-punctuation string">`</span></span>
      <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">

      var options = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">;

      options.insert = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>insert<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">;
      options.singleton = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>isSingleton<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">;

      var update = api(content, options);

      var exported = content.locals ? content.locals : {};

      </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>hmrCode<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">

      </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>esModule <span class="token operator">?</span> <span class="token string">'export default'</span> <span class="token operator">:</span> <span class="token string">'module.exports ='</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> exported;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br></div></div><p>ä¸»è¦å°±æ˜¯å›´ç»•<code>injectType</code>å’Œ<code>esModule</code>ä¸¤ä¸ªå±æ€§å¤„ç†ï¼Œæ ¹æ®<code>injectType</code>çš„ä¸åŒä½¿ç”¨ä¸åŒçš„ç”Ÿæˆæ¨¡å—æ¥ç”Ÿæˆ tagï¼Œæ ¹æ® esModule
å±æ€§æ¥è°ƒæ•´ç›¸åº”çš„å¯¼å…¥å¯¼å‡ºç»“æ„ã€‚ä½¿ç”¨ä»¥ä¸‹ç¤ºä¾‹æ¥çœ‹ä¸€ä¸‹å…¶å®å¦‚ä½•èµ·ä½œç”¨çš„</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">.</span>
â”œâ”€â”€ app.js
â”œâ”€â”€ node_modules
â”œâ”€â”€ package.json
â”œâ”€â”€ style.less
â””â”€â”€ webpack.config.js
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><code>webpakc.config.js</code>å¦‚ä¸‹</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
  entry<span class="token operator">:</span> <span class="token punctuation">{</span>
    app<span class="token operator">:</span> <span class="token string">'./app.js'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    filename<span class="token operator">:</span> <span class="token string">'[name].bundle.js'</span><span class="token punctuation">,</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    publicPath<span class="token operator">:</span> <span class="token string">''</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.less$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
        loader<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token string">&quot;style-loader&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;less-loader&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p><code>app.js</code> å¦‚ä¸‹</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token string">'./style.less'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>style.less</code> å¦‚ä¸‹</p> <div class="language-less line-numbers-mode"><pre class="language-less"><code><span class="token selector">.hello</span> <span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
  <span class="token selector">.world</span> <span class="token punctuation">{</span>
    <span class="token property">color</span><span class="token punctuation">:</span> blue<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>ç›´æ¥è¿è¡Œæ‰“å° <code>style-loader</code> çš„ pitch çš„è¾“å‡º</p> <div class="language-js line-numbers-mode"><div class="highlight-lines"><br><br><div class="highlighted">Â </div><div class="highlighted">Â </div><br><br><br><br><br><br><br><div class="highlighted">Â </div><br><br><br></div><pre class="language-js"><code><span class="token comment">// è¾“å‡ºï¼Œè¿”å›å€¼</span>
styleLoaderResult <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  var api = require(&quot;!./node_modules/_style-loader@1.3.0@style-loader/dist/runtime/injectStylesIntoStyleTag.js&quot;);
  var content = require(&quot;!!./node_modules/css-loader/dist/cjs.js!./node_modules/less-loader/dist/cjs.js!./style.less&quot;);
  content = content.__esModule ? content.default : content;
  if (typeof content === 'string') {
    content = [[module.id, content, '']];
  }
  var options = {};
  options.insert = &quot;head&quot;;
  options.singleton = false;
  var update = api(content, options);
  module.exports = content.locals || {};
</span><span class="token template-punctuation string">`</span></span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>æ ¹æ®å‰é¢å…³äº pitch çš„æè¿°ï¼Œç”±äºè¿™é‡Œè¿”å›äº†ï¼Œé‚£ä¹ˆåé¢çš„ css-loaderã€less-loader çš„ pitch å’Œ normal æ–¹æ³•éƒ½è¢«è·³è¿‡äº†ã€‚
ä½†æ˜¯æ˜¾ç„¶æ²¡æœ‰é‚£ä¹ˆç®€å•ï¼Œless æ–‡ä»¶å¿…é¡»è¦å¤„ç†ï¼Œä¸å¯èƒ½çœŸçš„è·³è¿‡è½¬æ¢çš„è¿‡ç¨‹ã€‚
<br></p> <p>style-loader pitch æ–¹æ³•çš„è·³è¿‡ï¼Œæ˜¯ä»¥å¦ä¸€ç§æ–¹å¼æ‰§è¡Œäº†ã€‚
æ³¨æ„é«˜äº®çš„è¡Œï¼Œè¿™é‡Œçš„<code>require</code>å°±æ˜¯æ‰€è°“çš„ <code>inline</code> æ–¹å¼ä½¿ç”¨ï¼Œé€šè¿‡ require è·å¾— less-loaderï¼Œcss-loader è¿”å›çš„ cssï¼Œç„¶åå†è°ƒç”¨<code>injectStylesIntoStyleTag.js</code>ä¸­å¯¼å‡ºçš„æ–¹æ³•è¿›è¡Œäº†æ’å…¥ã€‚
ä¸ºä»€ä¹ˆè¦è¿™æ ·åšå‘¢ï¼Ÿè¿™ä¸ css-loader çš„è¿”å›å€¼æœ‰å…³ï¼Œcss-loader è¿”å›ç¤ºä¾‹å¦‚ä¸‹</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>cssLoaderResult <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">// Imports
  var ___CSS_LOADER_API_IMPORT___ = require(&quot;./node_modules/_css-loader@3.6.0@css-loader/dist/runtime/api.js&quot;);
  exports = ___CSS_LOADER_API_IMPORT___(false);
  // Module
  exports.push([module.id, &quot;.hello { color: red;\\n}\\n&quot;, &quot;&quot;]);
  // Exports
  module.exports = exports;
</span><span class="token template-punctuation string">`</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>è¿”å›çš„æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ˜¯ä»¥æ¨¡å—çš„æ–¹å¼å¯¼å‡ºï¼Œè€Œéç›´æ¥æ˜¯<code>css</code>æ–‡æœ¬ã€‚
æˆ‘ä»¬è¦è·å–åˆ°é‡Œé¢çš„ cssï¼Œéœ€è¦ require å†è·å–ã€‚
ä½¿ç”¨ require åï¼Œwebpack å°†å…¶ä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„æ¨¡å—ï¼Œå¦‚ä¸‹åœ¨webpackçš„å¯¼å‡ºä¸­ï¼ŒcssLoaderResult ä½œä¸ºä¸€ä¸ªç‹¬ç«‹æ¨¡å—</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">modules</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// webpackBootstrap</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">&quot;./app.js&quot;</span><span class="token operator">:</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> __webpack_exports__<span class="token punctuation">,</span> __webpack_require__</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">eval</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ...çœç•¥å…·ä½“å†…å®¹</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token string">&quot;./node_modules/_css-loader@3.6.0@css-loader/dist/cjs.js!./node_modules/_less-loader@6.2.0@less-loader/dist/cjs.js!./style.less&quot;</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack_require__</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">eval</span><span class="token punctuation">(</span>cssLoaderResult<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ...</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token string">&quot;./node_modules/_css-loader@3.6.0@css-loader/dist/runtime/api.js&quot;</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack_require__</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>
      <span class="token function">eval</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ...çœç•¥å…·ä½“å†…å®¹</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token string">&quot;./node_modules/_style-loader@1.3.0@style-loader/dist/runtime/injectStylesIntoStyleTag.js&quot;</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack_require__</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>
      <span class="token function">eval</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ...çœç•¥å…·ä½“å†…å®¹</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token string">&quot;./style.less&quot;</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack_require__</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">eval</span><span class="token punctuation">(</span>styleLoaderResult<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ...çœç•¥å…·ä½“å†…å®¹</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>åœ¨æµè§ˆå™¨ä¸­å°±å¯ä»¥ä½¿ç”¨ eval æ‰§è¡Œ<code>styleLoaderResult</code>ï¼Œå…¶ä¸­ require äº† css-loader å¯¼å‡ºå†…å®¹å¯¹åº”æ¨¡å—ï¼Œä¼šæå–å‡º css å†…å®¹äº¤ç»™ style-loader è¿›è¡Œ updateã€‚</p> <h3 id="pitch-çš„åä¸‡ä¸ªä¸ºä»€ä¹ˆ"><a href="#pitch-çš„åä¸‡ä¸ªä¸ºä»€ä¹ˆ" class="header-anchor">#</a> pitch çš„åä¸‡ä¸ªä¸ºä»€ä¹ˆ</h3> <p>è€å®è¯´ï¼Œäº†è§£äº† styleLoader.pitchï¼Œä»æ—§ä¸èƒ½å¾ˆå¥½åœ°ç†è§£ pitchï¼Œpitch è¿™ä¸ªä¸œè¥¿å°±å¾ˆåˆ«æ‰­ã€‚</p> <p>style-loader ä½¿ç”¨ pitchï¼Œæ˜¯åŸºäºåœ¨å‰é¢æ‰§è¡Œçš„ less-loader å’Œ css-loader çš„è¿”å›å€¼çš„ã€‚
css-loader è¿”å›åŒ…å«äº†</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./node_modules/_css-loader@3.6.0@css-loader/dist/runtime/api.js&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>cssLoaderResult ä¸­çš„ require ç›¸å…³çš„å†…å®¹äº¤ç»™éœ€è¦ webpack è¿›è¡Œå¤„ç†ã€‚
ä¸æ­¤åŒæ—¶ï¼Œstyle-loader çš„å·¥ä½œï¼Œå°±æ˜¯å°† css æ’å…¥åˆ° html ä¸­ï¼Œstyle-loader éœ€è¦è·å–åˆ° cssLoaderResult ä¸­åŒ…å«çš„ css æ–‡æœ¬</p> <p>äºæ˜¯</p> <p>webpack å’Œ style-loader ä¸¤è€…éƒ½éœ€è¦ cssLoaderResult</p> <p>åœ¨ style-loader ä¸­ä½¿ç”¨ï¼Œå°±æ˜¯åˆ©ç”¨ webpack å°† require çš„å†…å®¹ä½œä¸ºå•ç‹¬æ¨¡å—ï¼Œç„¶å style-loader è°ƒç”¨è¿™ä¸ªæ¨¡å—è·å–è¿”å›çš„ css å†…å®¹ã€‚</p> <p><span bold="" class="bold" data-v-2a0a1bb2>æ ¹æ® css-loader çš„è¿”å›å†…å®¹ï¼Œè§£é‡Šäº†ä¸ºä»€ä¹ˆè¦ç”¨ requireï¼Œä½†æ˜¯æˆ‘è§‰å¾—å…¶å® style-loader é‡Œé¢çš„ pitch å¹¶ä¸å¿…è¦ã€‚style-loader å¹¶ä¸èƒ½è·³è¿‡ css-loader å’Œ less-loaderï¼Œé‚£ä¹ˆåœ¨ pitch å’Œ normal å¤„ç†åˆæœ‰ä½•åŒºåˆ«å‘¢ï¼Ÿå®Œå…¨å¯ä»¥åœ¨ normal é‡Œé¢å»å®ç°ã€‚</span></p> <p>ä¹Ÿè®¸ style-loader å¹¶ä¸æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ï¼Œæ¯•ç«Ÿ pitch çš„æ‰§è¡Œæ—¶æœºæ„å‘³ç€è¿˜å¯ä»¥åšå…¶ä»–å¾ˆå¤šäº‹æƒ…ã€‚
æˆ‘è§‰å¾— pitch è¿™ä¸ªä¸œè¥¿å¾ˆåˆ«æ‰­ï¼Œç›®å‰è€Œè¨€éš¾ä»¥è®¤å¯ pitch çš„ä»·å€¼ã€‚</p> <h2 id="plugin"><a href="#plugin" class="header-anchor">#</a> plugin</h2> <p>Webpack æœ¬èº«æ˜¯ä¸€ä¸ªäº‹ä»¶æµæ’ä»¶ç³»ç»Ÿï¼Œåœ¨å·¥ä½œæµç¨‹ä¸­çš„ä¸¤ä¸ªæ ¸å¿ƒå†…å®¹æ˜¯ loader å’Œ pluginï¼Œloader æ›´å¤šåœ°ä¸“æ³¨äºâ€è½¬æ¢â€œï¼Œè¯­æ³•çš„è½¬æ¢ï¼Œæ–‡ä»¶è½¬æ¢ä¸ºæœ‰æ•ˆçš„æ¨¡å—ç­‰ï¼Œè€Œ loader ä¹‹å¤–çš„äº‹æƒ…ï¼Œéƒ½ç”± plugin æ¥åšï¼Œå¦‚åˆ›å»ºç›®å½•ï¼Œchunkæ‹†åˆ†ç­‰ã€‚</p> <h3 id="åŸºæœ¬ç»“æ„"><a href="#åŸºæœ¬ç»“æ„" class="header-anchor">#</a> åŸºæœ¬ç»“æ„</h3> <p>å†™æ’ä»¶æ—¶ï¼Œäº†è§£ compiler å’Œ compilation æ˜¯å¿…é¡»çš„ï¼Œè¿™ä¸¤ä¸ªæ ¸å¿ƒå¯¹è±¡éƒ½ç»§æ‰¿è‡ª Tapableï¼Œéƒ½æœ‰è‡ªèº«çš„ä¸€äº› hooks å®šä¹‰ã€‚æ’ä»¶éƒ½æ˜¯åŸºäº compiler.hooksï¼ŒåŸºæœ¬æ ¼å¼å¦‚ä¸‹</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">TestPlugin</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> options<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>compilation<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">'TestPlugin'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">compilation<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'å“ˆå“ˆå“ˆ'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// </span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> TestPlugin<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>æ’ä»¶å¯¼å‡ºä¸€ä¸ª class/æ„é€ å‡½æ•°ï¼Œapply æ–¹æ³•æ¥æ”¶ compiler å‚æ•°ï¼Œåœ¨æ’ä»¶å†…éƒ¨è®¢é˜…æŸä¸ª compiler äº‹ä»¶ï¼Œç„¶åæ·»åŠ ä¸€ä¸ª callbackã€‚
callback å‚æ•°ä¸æ˜¯ç»Ÿä¸€çš„ï¼Œä¸åŒçš„äº‹ä»¶å¯èƒ½æœ‰ä¸åŒçš„å‚æ•°ï¼Œå¯å‚è€ƒ <a href="https://webpack.js.org/api/compiler-hooks/" target="_blank" rel="noopener noreferrer">Compiler Hooks<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>(æç¤ºï¼Œhookså±•ç¤ºé¡ºåºä¸æ‰§è¡Œé¡ºåºä¸€è‡´ï¼Œå¯é€šè¿‡æ­¤åˆ—è¡¨å¿«é€Ÿäº†è§£ Webpack æµç¨‹)ã€‚</p> <h3 id="å¦‚ä½•ä½¿ç”¨"><a href="#å¦‚ä½•ä½¿ç”¨" class="header-anchor">#</a> å¦‚ä½•ä½¿ç”¨</h3> <p>æ’ä»¶æ˜¯ç”¨æ¥è®¢é˜…äº‹ä»¶çš„ï¼Œæ— æ³•è„±ç¦» compiler è€Œå­˜åœ¨ï¼Œæ²¡æœ‰åƒ loader çš„ loader-runner é‚£æ ·çš„ç‹¬ç«‹è¿è¡Œç¯å¢ƒï¼Œéœ€è¦åœ¨ webpack.config.js ä½¿ç”¨</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> TestPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./test-plugin.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
  entry<span class="token operator">:</span> <span class="token punctuation">{</span>
    app<span class="token operator">:</span> <span class="token string">'./app.js'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    filename<span class="token operator">:</span> <span class="token string">'[name].bundle.js'</span><span class="token punctuation">,</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    publicPath<span class="token operator">:</span> <span class="token string">''</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">TestPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      mode<span class="token operator">:</span> <span class="token string">'development'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>æ’ä»¶å°†åœ¨ compiler åˆå§‹åŒ–çš„æ—¶å€™æ‰§è¡Œã€‚</p> <h2 id="rebuild-hmr"><a href="#rebuild-hmr" class="header-anchor">#</a> Rebuild &amp; HMR</h2> <p>Webpack ä¸­çš„æ–‡ä»¶ç›‘å¬ï¼ŒåŸºæœ¬åŸç†æ˜¯å‘¨æœŸæ€§æ¯”è¾ƒæ–‡ä»¶çš„æœ€åç¼–è¾‘æ—¶é—´ï¼Œç›‘å¬çš„æºç å˜åŒ–æ—¶é‡æ–°æ„å»ºã€‚
Rebuild å­˜åœ¨çš„é—®é¢˜/ä¸è¶³ æ˜¯éœ€è¦æ‰‹åŠ¨åˆ·æ–°æµè§ˆå™¨ï¼Œè¿˜æœ‰å°±æ˜¯æ„å»ºçš„å†…å®¹åœ¨ç¡¬ç›˜ä¸Šï¼Œæœ‰I/Oæˆæœ¬ã€‚</p> <p>æ‰‹åŠ¨åˆ·æ–°è‡ªç„¶æ˜¯éœ€è¦ä¼˜åŒ–çš„ï¼Œè¦åšåˆ°è‡ªåŠ¨æ›´æ–°ï¼Œé€»è¾‘ä¸Šä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯å°†æ„å»ºåçš„è¾“å‡ºæ¨é€ç»™å®¢æˆ·ç«¯(å¦‚SPAåº”ç”¨)ï¼Œå®¢æˆ·ç«¯è‡ªåŠ¨åˆ·æ–°ï¼Œè¿™å°±æ˜¯æ‰€è°“çƒ­æ›´æ–°ã€‚</p> <p>çƒ­æ›´æ–°ï¼Œæ‰“ä¸ªæ¯”æ–¹æ¥è¯´ï¼Œå°±æ˜¯ç©ºä¸­åŠ æ²¹ã€‚</p> <p>è¦å®ç°å°†æ„å»ºåçš„è¾“å‡ºæ¨é€ç»™é¡µé¢ï¼Œéœ€è¦å»ºç«‹ Webpack Compiler å’Œ Application ä¹‹é—´çš„é€šä¿¡ï¼Œéœ€è¦ç”¨åˆ° WebSocketã€‚
ç”±äºé€šä¿¡å’Œæ›´æ–°çš„éœ€è¦ï¼ŒCompiler å’Œ Application å¿…ç„¶éœ€è¦å¢åŠ  WS ç›¸å…³çš„ä»£ç ï¼ŒApplication å¿…ç„¶éœ€è¦å¢åŠ æ›´æ–°ç›¸å…³çš„ä»£ç ã€‚</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// Webpack</span>
<span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hasChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">rebuild</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    socket<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// poll prop in webpack.config.js</span>

<span class="token comment">// Application</span>
socket<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">update</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="æ–‡ä»¶æŒ‡çº¹"><a href="#æ–‡ä»¶æŒ‡çº¹" class="header-anchor">#</a> æ–‡ä»¶æŒ‡çº¹</h2> <p>æ–‡ä»¶æŒ‡çº¹ï¼Œå¤§çº¦å¯ä»¥ç†è§£ä¸ºæ‰“åŒ…åè¾“å‡ºçš„æ–‡ä»¶åï¼Œåº”å½“é’ˆå¯¹ä¸åŒçš„æ–‡ä»¶ï¼Œä½¿ç”¨ä¸åŒçš„æŒ‡çº¹ç­–ç•¥ï¼Œä»¥ä¾¿å……åˆ†åˆ©ç”¨ç¼“å­˜ã€‚
Webpack é‡Œé¢æœ‰ä¸‰ç±» hash</p> <table><thead><tr><th>åç§°</th> <th>å«ä¹‰</th> <th>ä½¿ç”¨</th></tr></thead> <tbody><tr><td>fullhash</td> <td>æ•´ä¸ªé¡¹ç›®çš„ hashï¼Œä»»æ„ä¾èµ–æ–‡ä»¶æ”¹å˜åˆ™å˜</td> <td>åªè¦æ•´ä¸ªé¡¹ç›®æœ‰æ”¹åŠ¨å°±éœ€è¦åˆ·æ–°çš„å†…å®¹</td></tr> <tr><td>chunkhash</td> <td>compilation é˜¶æ®µ chunk çš„ hash</td> <td>output å¸¸ç”¨ chunkhash</td></tr> <tr><td>contenthash</td> <td>æ–‡ä»¶/æ¨¡å—ç‹¬ç«‹çš„ hashï¼Œæ–‡ä»¶ä¸å˜åˆ™ä¸å˜</td> <td>cssï¼Œimgï¼Œfont ç­‰èµ„æºä½¿ç”¨</td></tr> <tr><td>hash</td> <td>æ¨¡å—å”¯ä¸€çš„ idï¼Œå¯¹äºå›¾ç‰‡ï¼Œå­—ä½“ç­‰èµ„æºæ–‡ä»¶ï¼Œæ–‡ä»¶ä¸å˜åˆ™ä¸å˜</td> <td>cssï¼Œimgï¼Œfont ç­‰èµ„æºä½¿ç”¨</td></tr></tbody></table> <p>å“ˆå¸Œå€¼çš„ç”Ÿæˆï¼ŒWebpack 4 ä¹‹å‰ä½¿ç”¨çš„æ˜¯ md5ï¼Œå‡ºäºæ€§èƒ½åŸå› è°ƒæ•´ä¸º md4ã€‚é»˜è®¤ä½¿ç”¨16è¿›åˆ¶ç¼–ç å–å‰20ä½ï¼Œä»£ç ç¤ºæ„å¦‚ä¸‹</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> crypto <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'crypto'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> hash <span class="token operator">=</span> crypto<span class="token punctuation">.</span><span class="token function">createHash</span><span class="token punctuation">(</span><span class="token string">'md4'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> chunkhash <span class="token operator">=</span> hash<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>åœ¨ output æœ‰ hashFunction ç­‰å‡ ä¸ªå±æ€§è¿›è¡Œé…ç½®ï¼ŒåŸºæœ¬ä¸Šé»˜è®¤å³å¯ã€‚</p> <p>å……åˆ†åˆ©ç”¨ç¼“å­˜ï¼Œè¦æ±‚å–„ç”¨æ„å»ºç›¸å…³çš„ hash å»è®¾ç½®æ–‡ä»¶åç§°ï¼Œç„¶åä¸ Web æœåŠ¡å™¨åŠ CDN ç¼“å­˜ç­–ç•¥ç­‰ç»„åˆä½¿ç”¨ã€‚è¦åšåˆ°ä¸¤ä¸ªç‚¹ï¼š</p> <ul><li>èƒ½ç”¨ç¼“å­˜çš„å°±ç”¨ç¼“å­˜ï¼šä¸¾ä¾‹æ¥è¯´ï¼Œä¸€ä¸ªå›¾ç‰‡ï¼Œå¦‚æœæ²¡æœ‰æ”¹å˜ï¼Œä½†æ–‡ä»¶åå´æ¯æ¬¡æ„å»ºéƒ½å˜åŒ–ï¼Œé‚£ç¼“å­˜å°±å¤±æ•ˆäº†ã€‚file-loader é»˜è®¤ä½¿ç”¨äº†<code>[contenthash].[ext]</code>ä½œä¸ºè¾“å‡ºåç§°ï¼Œè¿™å°±æ¯”è¾ƒåˆç†ã€‚</li> <li>æœ‰æ›´æ–°çš„è¦èƒ½åŠæ—¶åˆ·æ–°ï¼šä¸¾ä¾‹æ¥è¯´ï¼Œå¯¹äºç¨‹åº main bundleï¼Œå¦‚æœä½¿ç”¨ app.js è¿™æ ·çš„åç§°ï¼Œé‚£ä¿®æ”¹é‡æ–°å‘å¸ƒåå°±ä¼šå‡ºé—®é¢˜ã€‚ï¼ˆå½“ç„¶ï¼Œéå¾—è¯´å¼ºåˆ¶ç¦æ­¢ç¼“å­˜ä¹Ÿèƒ½åˆ·æ–°ï¼Œè¿™æ²¡é”™ï¼Œä½†...è¿™ä¸æ˜¯æ›´ä¸¥é‡å—)</li></ul> <p>å…³äºæ–‡ä»¶æŒ‡çº¹ç»å…¸çš„ä¸€ä¸ªé…ç½®ä¾‹å­æ˜¯ css æ–‡ä»¶çš„è®¾ç½®ã€‚
å½“ä½¿ç”¨ MiniCssExtractPlugin å°† CSS å¯¼å‡ºä¸ºå•ç‹¬çš„æ–‡ä»¶æ—¶</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// webpack.config.js</span>
plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    filename<span class="token operator">:</span> <span class="token string">'[contenthash].css'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>è€Œ å…¥å£æ–‡ä»¶ app.js å¦‚ä¸‹</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token string">'./style.less'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">AGE</span> <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>å¦‚æœè®¾ç½® filename ä¸º <code>[chunkhash].css</code>ï¼Œé‚£ä¹ˆå½“ style.css æ²¡æœ‰æ”¹å˜ï¼Œè€Œåªæ˜¯ app.js æ”¹å˜æ—¶ï¼Œç”Ÿæˆçš„ css æ–‡ä»¶åç§°ä¹Ÿä¼šæ”¹å˜ï¼Œè¿™å°±å¾ˆä¸å¿…è¦ã€‚</p> <p><span orange="" class="orange" data-v-2a0a1bb2>æ³¨æ„ï¼šå¯¹äºfilenameé…ç½®çš„æ¨¡æ¿å­—ç¬¦ä¸²ï¼Œä¸åŒçº§åˆ«èƒ½å¤Ÿä½¿ç”¨çš„å˜é‡æ˜¯ä¸åŒçš„ï¼Œæ³¨æ„ä»¥å‰fullhashä¹Ÿå«åšhashï¼Œå› æ­¤è¿™é‡Œéœ€è¦æ³¨æ„<code data-v-2a0a1bb2>[hash]</code>ä½¿ç”¨çš„levelï¼Œå‚è€ƒ<a href="https://webpack.js.org/configuration/output/#template-strings" target="_blank" rel="noopener noreferrer" data-v-2a0a1bb2>Template strings<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ã€‚</span></p> <h2 id="è¾“å‡ºç»“æ„"><a href="#è¾“å‡ºç»“æ„" class="header-anchor">#</a> è¾“å‡ºç»“æ„</h2> <p>æœ‰ä»¥ä¸‹ä»£ç , app.js</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token string">'./style.less'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> print <span class="token keyword">from</span> <span class="token string">'./print'</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'male'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">AGE</span> <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>print.js</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> dict <span class="token operator">=</span> <span class="token punctuation">{</span>
  male<span class="token operator">:</span> <span class="token string">'MALE'</span><span class="token punctuation">,</span>
  female<span class="token operator">:</span> <span class="token string">'FEMALE'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token parameter">prop</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'value is '</span><span class="token punctuation">,</span> dict<span class="token punctuation">[</span>prop<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œæ··ç”¨äº† ES6 Module å’Œ CommonJSã€‚
ä»¥ app.js ä½œä¸ºå…¥å£ï¼Œå¼€å‘æ¨¡å¼ä¸‹ä½¿ç”¨äº†<code>devtool: 'eval'</code>çš„ä¸€ä¸ªè¾“å‡ºç¤ºä¾‹å¦‚ä¸‹</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">modules</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// The module cache</span>
  <span class="token keyword">var</span> installedModules <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// The require function</span>
  
  <span class="token keyword">function</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span><span class="token parameter">moduleId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Check if module is in cache</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// Create a new module (and put it into the cache)</span>
    <span class="token keyword">var</span> module <span class="token operator">=</span> <span class="token punctuation">(</span>installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
      i<span class="token operator">:</span> moduleId<span class="token punctuation">,</span>
      l<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      exports<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Execute the module function</span>
    modules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>
      module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span>
      module<span class="token punctuation">,</span>
      module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span>
      __webpack_require__
    <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Flag the module as loaded</span>
  
    module<span class="token punctuation">.</span>l <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// Return the exports of the module</span>
  
    <span class="token keyword">return</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// expose the modules object (__webpack_modules__)</span>
  __webpack_require__<span class="token punctuation">.</span>m <span class="token operator">=</span> modules<span class="token punctuation">;</span> <span class="token comment">// expose the module cache</span>

  __webpack_require__<span class="token punctuation">.</span>c <span class="token operator">=</span> installedModules<span class="token punctuation">;</span> <span class="token comment">// define getter function for harmony exports</span>

  __webpack_require__<span class="token punctuation">.</span><span class="token function-variable function">d</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">exports<span class="token punctuation">,</span> name<span class="token punctuation">,</span> getter</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>__webpack_require__<span class="token punctuation">.</span><span class="token function">o</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> name<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        enumerable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        get<span class="token operator">:</span> getter
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span> 
  
  <span class="token comment">// define __esModule on exports</span>
  __webpack_require__<span class="token punctuation">.</span><span class="token function-variable function">r</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">exports</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> Symbol <span class="token operator">!==</span> <span class="token string">&quot;undefined&quot;</span> <span class="token operator">&amp;&amp;</span> Symbol<span class="token punctuation">.</span>toStringTag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> Symbol<span class="token punctuation">.</span>toStringTag<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        value<span class="token operator">:</span> <span class="token string">&quot;Module&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token string">&quot;__esModule&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> value<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// create a fake namespace object // mode &amp; 1: value is a module id, require it // mode &amp; 2: merge all properties of value into the ns // mode &amp; 4: return value when already ns object // mode &amp; 8|1: behave like require</span>
  
  __webpack_require__<span class="token punctuation">.</span><span class="token function-variable function">t</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>
    <span class="token parameter">value<span class="token punctuation">,</span>
    mode</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">if</span> <span class="token punctuation">(</span>mode <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> value <span class="token operator">=</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">if</span> <span class="token punctuation">(</span>mode <span class="token operator">&amp;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token keyword">return</span> value<span class="token punctuation">;</span>
     <span class="token keyword">if</span> <span class="token punctuation">(</span>
      mode <span class="token operator">&amp;</span> <span class="token number">4</span> <span class="token operator">&amp;&amp;</span>
      <span class="token keyword">typeof</span> value <span class="token operator">===</span> <span class="token string">&quot;object&quot;</span> <span class="token operator">&amp;&amp;</span>
      value <span class="token operator">&amp;&amp;</span>
      value<span class="token punctuation">.</span>__esModule
    <span class="token punctuation">)</span>
      <span class="token keyword">return</span> value<span class="token punctuation">;</span>
     <span class="token keyword">var</span> ns <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     __webpack_require__<span class="token punctuation">.</span><span class="token function">r</span><span class="token punctuation">(</span>ns<span class="token punctuation">)</span><span class="token punctuation">;</span>
     Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>ns<span class="token punctuation">,</span> <span class="token string">&quot;default&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      enumerable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      value<span class="token operator">:</span> value
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">if</span> <span class="token punctuation">(</span>mode <span class="token operator">&amp;</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> value <span class="token operator">!=</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> value<span class="token punctuation">)</span>
        __webpack_require__<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>
          ns<span class="token punctuation">,</span>
          key<span class="token punctuation">,</span>
          <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> value<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">return</span> ns<span class="token punctuation">;</span>
    
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  
  <span class="token comment">// getDefaultExport function for compatibility with non-harmony modules</span>
  __webpack_require__<span class="token punctuation">.</span><span class="token function-variable function">n</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">var</span> getter <span class="token operator">=</span>
      module <span class="token operator">&amp;&amp;</span> module<span class="token punctuation">.</span>__esModule
        <span class="token operator">?</span>  <span class="token keyword">function</span> <span class="token function">getDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> module<span class="token punctuation">[</span><span class="token string">&quot;default&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token operator">:</span>  <span class="token keyword">function</span> <span class="token function">getModuleExports</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> module<span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">;</span>
     __webpack_require__<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>getter<span class="token punctuation">,</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> getter<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">return</span> getter<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Object.prototype.hasOwnProperty.call</span>
  __webpack_require__<span class="token punctuation">.</span><span class="token function-variable function">o</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">object<span class="token punctuation">,</span> property</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>object<span class="token punctuation">,</span> property<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  
  <span class="token comment">// __webpack_public_path__</span>
  __webpack_require__<span class="token punctuation">.</span>p <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span>__webpack_require__<span class="token punctuation">.</span>s <span class="token operator">=</span> <span class="token string">&quot;./app.js&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token string">&quot;./app.js&quot;</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> __webpack_exports__<span class="token punctuation">,</span> __webpack_require__</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>
      <span class="token function">eval</span><span class="token punctuation">(</span>
        <span class="token string">'__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _style_less__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./style.less */ &quot;./style.less&quot;);\n/* harmony import */ var _print__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./print */ &quot;./print.js&quot;);\n/* harmony import */ var _print__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_print__WEBPACK_IMPORTED_MODULE_1__);\n\n\n_print__WEBPACK_IMPORTED_MODULE_1___default()(\'male\');\nvar AGE = 100;\n\n//# sourceURL=webpack:///./app.js?'</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token string">&quot;./print.js&quot;</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">eval</span><span class="token punctuation">(</span>
        <span class="token string">&quot;var dict = {\n  male: 'MALE',\n  female: 'FEMALE'\n};\n\nmodule.exports = function print(prop) {\n  conssole.log('value is ', dict[prop]);\n};\n\n//# sourceURL=webpack:///./print.js?&quot;</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token string">&quot;./style.less&quot;</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> __webpack_exports__<span class="token punctuation">,</span> __webpack_require__</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>
      <span class="token function">eval</span><span class="token punctuation">(</span>
        <span class="token string">&quot;__webpack_require__.r(__webpack_exports__);\n// extracted by mini-css-extract-plugin\n\n\n//# sourceURL=webpack:///./style.less?&quot;</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br></div></div><p>è¿™æ˜¯ä¸€ä¸ª IIFEï¼Œè¿™ä¸ªå‡½æ•°ç§°ä¸ºå¼•å¯¼å‡½æ•°ï¼Œå‚æ•° modules æ˜¯åœ¨ compilation é˜¶æ®µçš„ compilation.modules è½¬æ¢è€Œæ¥ã€‚
å¯ä»¥çœ‹åˆ°ï¼Œä»£ç ä¸­çš„æ¨¡å—ï¼Œè¢«ä¿å­˜åœ¨<code>installedModules</code>è¿™æ ·ä¸€ä¸ªå¯¹è±¡ä¸­ï¼Œ<code>__webpack_require__</code> ç­‰æ–¹æ³•ï¼Œç”¨äºè·å–æ¨¡å—ã€‚
åœ¨åŠ è½½åï¼Œä»£ç ä¾æ¬¡ä» <strong>webpack_require</strong>.s å¼€å§‹ï¼Œæå–æ¨¡å—ï¼Œä½¿ç”¨ eval æ‰§è¡Œï¼Œä»è€Œå®Œæˆæ•´ä¸ªæ‰§è¡Œè¿‡ç¨‹ã€‚
ä¸åšå¤ªç»†çš„åˆ†æäº†ï¼Œæ€»ç»“ä¸€ä¸‹å¼•å¯¼å‡½æ•°ä¸­å®šä¹‰çš„éƒ¨åˆ†å‡½æ•°çš„ä½œç”¨</p> <table><thead><tr><th>å‡½æ•°</th> <th>ä½œç”¨</th></tr></thead> <tbody><tr><td><strong>webpack_require</strong></td> <td>ç”¨äºæ¨¡å—åŠ è½½</td></tr> <tr><td><strong>webpack_require</strong>.r</td> <td>ç»™ <strong>webpack_exports</strong>ï¼ˆä¹Ÿå°±æ˜¯module.exports) å®šä¹‰ __esModuleï¼Œç”¨æ¥æ ‡è®°æ¨¡å—æ˜¯å¦æ˜¯ ES6 æ¨¡å—</td></tr> <tr><td><strong>webpack_require</strong>.n</td> <td>åˆ†æä¸€ä¸ªæ¨¡å—æ˜¯å¦æ˜¯ ES6 Moduleï¼Œå¦‚æœæ˜¯è¿”å› module['default']ï¼Œå¦‚æœä¸æ˜¯è¿”å› module</td></tr></tbody></table> <h2 id="source-map"><a href="#source-map" class="header-anchor">#</a> source map</h2> <p>source mapå¯ä»¥ç†è§£èµ„æºåœ°å›¾ï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºæ¨¡å—å­—å…¸ï¼Œåœ¨ <a href="https://webpack.js.org/configuration/devtool/#devtool" target="_blank" rel="noopener noreferrer">Devtool<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ä¸­çš„è¯´æ˜å¾ˆè¯¦ç»†äº†ã€‚
ä¸è¿‡å¹¶ä¸éœ€è¦è¿‡åˆ†å…³æ³¨å…¶ç»†èŠ‚ï¼Œsource map ä¸€ä¸ªæ˜¯ç”¨æ¥å¼€å‘ç¯èŠ‚è°ƒè¯•ï¼Œä¸€ä¸ªæ˜¯ç”¨æ¥åšç”Ÿäº§ç¯å¢ƒé”™è¯¯è¿½è¸ªã€‚</p> <p>éœ€è¦çŸ¥é“<code>inline</code>ï¼Œ<code>cheap</code>ç­‰å‰ç¼€çš„åŸºæœ¬å«ä¹‰ï¼ŒçŸ¥é“åœ¨å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒè¯¥å¦‚ä½•ä½¿ç”¨å³å¯ï¼Œæ¯”å¦‚æˆ‘ä¸€èˆ¬é€‰æ‹©</p> <ul><li>dev: eval-source-map</li> <li>prod: source-map</li></ul> <p>è¿˜æœ‰ä¸€äº›å°çŸ¥è¯†ç‚¹ï¼Œéœ€è¦ç¨å¾®äº†è§£</p> <ul><li>source mapåœ¨æµè§ˆå™¨ä¸­æ˜¯é€šè¿‡ <code>//# sourceURL=[url]</code> æ ‡è¯†çš„</li></ul> <p>åœ¨<code>eval</code>æ¨¡å¼è¾“å‡ºç»“æ„ä¸­ï¼Œæ¯ä¸ªæ¨¡å—æœ«å°¾æœ‰ä»¥ä¸‹æ ¼å¼çš„æ³¨é‡Š</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//# sourceURL=webpack:///./print.js</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>æµè§ˆå™¨ä¼šæ ¹æ®è¿™ä¸ªæ³¨é‡Šå»è§£ææ–‡ä»¶ï¼Œåœ¨å¼€å‘è€…å·¥å…·çš„ Sources Page é¢æ¿ä¸­å±•ç¤ºå¯¹åº”çš„æ–‡ä»¶ã€‚</p> <ul><li>å¦‚æœç”Ÿæˆç‹¬ç«‹çš„ <code>.map</code> æ–‡ä»¶ï¼Œåº”å½“åªæ”¾åœ¨æœåŠ¡ç«¯ï¼Œä¸å…è®¸å®¢æˆ·ç«¯è®¿é—®ï¼Œè¾“å‡ºä»£ç ä¸åº”æä¾›è¿‡äºå…·ä½“çš„æºç ä¿¡æ¯</li></ul> <h2 id="åŸºæœ¬éœ€æ±‚"><a href="#åŸºæœ¬éœ€æ±‚" class="header-anchor">#</a> åŸºæœ¬éœ€æ±‚</h2> <table><thead><tr><th>éœ€æ±‚</th> <th style="text-align:left;">é…ç½®è¯´æ˜</th></tr></thead> <tbody><tr><td>åŸºç¡€é…ç½®</td> <td style="text-align:left;">entry,output,hmr,module.rules ç­‰è®¾ç½®</td></tr> <tr><td>HTML å‹ç¼©</td> <td style="text-align:left;">html-webpack-plugin è®¾ç½® options.minify</td></tr> <tr><td>CSS å‹ç¼©</td> <td style="text-align:left;">optimize-css-assets-webpack-plugin <span orange="" bold="" class="orange bold" data-v-2a0a1bb2><sup data-v-2a0a1bb2>V4</sup></span> ï¼Œcss-minimizer-webpack-plugin <span green="" bold="" class="green bold" data-v-2a0a1bb2><sup data-v-2a0a1bb2>V5</sup></span></td></tr> <tr><td>CSS å…¼å®¹</td> <td style="text-align:left;">autoprefixer</td></tr> <tr><td>CSS é€‚é…</td> <td style="text-align:left;">px2rem-loader</td></tr> <tr><td>èµ„æºå†…è”</td> <td style="text-align:left;">raw-loaderï¼Œstyle-loader</td></tr> <tr><td>JS å‹ç¼©</td> <td style="text-align:left;">UglifyJsPlugin <span red="" bold="" class="red bold" data-v-2a0a1bb2><sup data-v-2a0a1bb2>V3</sup></span>ï¼Œ å†…ç½®é»˜è®¤å‹ç¼© <span orange="" bold="" class="orange bold" data-v-2a0a1bb2><sup data-v-2a0a1bb2>V4</sup></span></td></tr> <tr><td>å¤šé¡µé¢æ‰“åŒ…</td> <td style="text-align:left;">html-webpack-plugin ç»Ÿä¸€å¤„ç†</td></tr> <tr><td>æ„å»ºæ¸…ç†</td> <td style="text-align:left;">CleanWebpackPlugin <span orange="" bold="" class="orange bold" data-v-2a0a1bb2><sup data-v-2a0a1bb2>V4</sup></span>ï¼Œoutput.clean <span green="" bold="" class="green bold" data-v-2a0a1bb2><sup data-v-2a0a1bb2>V5</sup></span></td></tr> <tr><td>ä»£ç åˆ†å‰²</td> <td style="text-align:left;">SplitChunksPluginï¼ŒMiniCssExtractPlugin ä¹Ÿç®—ä¸€ç§ä»£ç åˆ†å‰²</td></tr> <tr><td>eslint</td> <td style="text-align:left;">åŸºäº eslint:recommendï¼Œpre-commitï¼Œeslint-loader(è€é¡¹ç›®)</td></tr> <tr><td>Prerender/SSR</td> <td style="text-align:left;">Nuxt ç­‰å®Œå–„çš„æ–¹æ¡ˆï¼Œæˆ–è€…å¯¹åº” vue-server-render ç­‰</td></tr> <tr><td>è¿‡ç¨‹åˆ†æ</td> <td style="text-align:left;">seed-measure-webpack-plugin</td></tr> <tr><td>ä½“ç§¯åˆ†æ</td> <td style="text-align:left;">webpack-bundle-analyzer</td></tr></tbody></table> <h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="header-anchor">#</a> æ€»ç»“</h2> <p>Webpack é‡Œé¢çš„ä¸¤ä¸ªæ ¸å¿ƒæ¨¡å—æ˜¯ loader å’Œ pluginï¼Œloader è´Ÿè´£è¯­æ³•è½¬æ¢ï¼Œæ–‡ä»¶è½¬æ¢ç­‰äº‹æƒ…ï¼Œè€Œ plugin åˆ™è´Ÿè´£å…¶ä»–çš„äº‹æƒ…ã€‚</p> <p>Webpack ä¸¤ä¸ªæ ¸å¿ƒå¯¹è±¡æ˜¯ compiler å’Œ compilationï¼Œå‰è€…è´Ÿè´£æ•´ä½“è°ƒåº¦ï¼Œåè€…è´Ÿè´£ä¸€æ¬¡å…·ä½“çš„ç¼–è¯‘è¿‡ç¨‹ï¼Œæ¯æ¬¡ç¼–è¯‘ç”Ÿæˆæ–°çš„ compilation å¯¹è±¡ã€‚</p> <p>Webpack æœ¬èº«æ˜¯ä¸€ä¸ªäº‹ä»¶æµæ’ä»¶ç³»ç»Ÿï¼Œcompiler å’Œ compilation éƒ½åŸºäº tapableã€‚
åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œcompiler å’Œ compilation å‘å¸ƒäº‹ä»¶ï¼Œå…·ä½“çš„ plugin è®¢é˜…å…³æ³¨çš„äº‹ä»¶å¹¶ä½œå¤„ç†ã€‚</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/docs/manual/engineering/babel.html" class="prev">
        Babel
      </a></span> <span class="next"><a href="/docs/manual/networking/">
        çŸ¥è¯†æ¦‚è¦
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"><div tabindex="-1" role="dialog" aria-hidden="true" class="pswp"><div class="pswp__bg"></div> <div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div> <div class="pswp__item"></div> <div class="pswp__item"></div></div> <div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div> <button class="pswp__button pswp__button--close"></button> <button class="pswp__button pswp__button--share"></button> <button class="pswp__button pswp__button--fs"></button> <button class="pswp__button pswp__button--zoom"></button> <div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div> <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div> <button class="pswp__button pswp__button--arrow--left"></button> <button class="pswp__button pswp__button--arrow--right"></button> <div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div></div></div>
    <script src="/docs/assets/js/app.ee212f52.js" defer></script><script src="/docs/assets/js/3.2c08a1e7.js" defer></script><script src="/docs/assets/js/51.1b73d6a7.js" defer></script><script src="/docs/assets/js/9.4626406b.js" defer></script><script src="/docs/assets/js/14.b16e20b9.js" defer></script>
  </body>
</html>
